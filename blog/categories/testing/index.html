<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Category: Testing - Developing on Staxmanade</title>
  <meta name="author" content="Jason Jarrett">


   <meta name="description" content="">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://staxmanade.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/DevelopingOnStaxmande" rel="alternate" title="Developing on Staxmanade" type="application/atom+xml">
    <script src="/js/modernizr-2.0.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./js/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6814534742514314",
          enable_page_level_ads: true
     });
</script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1017448-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body   >
<header role="banner"><hgroup>
  <h1><a href="/">Developing on Staxmanade</a></h1>

   <a class="subscribe-button" href="/subscribe">Subscribe</a>
</hgroup>

</header>
<nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/DevelopingOnStaxmande" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<div>
  <form action="//www.google.com" id="cse-search-box">
    <div>
      <input type="hidden" name="cx" value="partner-pub-6814534742514314:2581894146" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" name="q" size="25" />
      <input type="submit" name="sa" value="Search" />
    </div>
  </form>

  <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
</div>
</nav>
<div id="main">
    <div id="content">

        <div class="blog-index">
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2019/05/spend-the-effort-to-make-your-tests-better-documentation/">Spend the Effort to Make Your Tests Better Documentation</a></h1>
    <p class="meta">
          <time datetime="2019-05-12T17:54:12.628Z" pubdate data-updated="true">May 12th 2019</time>


        <a href="/2019/05/spend-the-effort-to-make-your-tests-better-documentation/#disqus_thread" data-disqus-identifier="/2019/05/spend-the-effort-to-make-your-tests-better-documentation/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>You may be writing tests, but are they describing the behavior well enough to know what business case it's covering a year from now?</p>
<p>Today's lesson or re-lesson. <a href="https://staxmanade.com/2012/01/you-are-responsible-for-making-that/">Don't just write your tests</a>, <em>write it so you can understand the intricacies a year from now</em>.</p>
<p>The other day I was pairing on a what we first thought was a bug in our software. I was explaining something we saw.. &quot;oh yea, that's a bug, oh and look at these tests, they look wrong also. Why is this so wrong? How did we not catch this last year? Something is off here... etc...&quot;</p>
<p>While I had some tests to cover a business requirement a year ago when we wrote the software, I had not properly described the business case within the test to document it's purpose.</p>
<p>The subtle, bug-look-a-likes turned out to be proper behavior. If only I had not just documented the expected behavior via a test, but had properly describe WHY this behavior existed within the test, we could have avoided potentially breaking it (by &quot;trying to fix it&quot;) and the test could have better communicated the WHY of this strange case.</p>
<p>This is just a reminder to myself to write better tests. Doing tests, great. Well documented, business explanation of the WHY in the tests? Way better!</p>
<p>Happy testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2018/08/using-script-module-to-quicky-spike-some-mocha-tests/">Using script=module to Quicky Spike Some Mocha Tests</a></h1>
    <p class="meta">
          <time datetime="2018-08-03T21:42:53.703Z" pubdate data-updated="true">Aug 3rd 2018</time>


        <a href="/2018/08/using-script-module-to-quicky-spike-some-mocha-tests/#disqus_thread" data-disqus-identifier="/2018/08/using-script-module-to-quicky-spike-some-mocha-tests/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I'll be honest, I secretly hoped JSPM would win the front end over and become our standard, and while I haven't truly followed it closely in the last year or so I recently tried this out and was blown away at how beautifully simple it is (at least on the surface).</p>
<p>Say I want to quickly run some Mocha test in a browser. Like say I'm spiking something, wanting to use tests in something like jsbin or plunkr and just get code running quickly.</p>
<p>Most browsers now <a href="https://caniuse.com/#feat=es6-module">support tye script=module</a> tag which allows you to use <code>import</code> statements withing browser script tags. O_O</p>
<p>So how could I use this to <code>import mocha</code> and write some quick tests? I'm so glad you asked.</p>
<ol>
<li>Mocha's browser U.I. looks for an element with <code>id=mocha</code> so let's add that.</li>
</ol>
<pre><code class="language-diff">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
<span class="hljs-addition">+  &lt;div id="mocha"&gt;&lt;/div&gt;</span>
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ol start="2">
<li>now let's add some javascript to import mocha</li>
</ol>
<pre><code class="language-diff">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;div id="mocha"&gt;&lt;/div&gt;
<span class="hljs-addition">+  &lt;script type="module"&gt;</span>
<span class="hljs-addition">+    import "https://dev.jspm.io/mocha"</span>
<span class="hljs-addition">+    console.log("Mocha:", Mocha);</span>
<span class="hljs-addition">+  &lt;/script&gt;</span>
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This package is loaded using the <code>import</code> functionality built into our browsers now and JSPM which allows us to load some <code>npm</code> packages right through the browser. MAGIC!</p>
<blockquote>
<p>WARNING: DO NOT do this for a production-type environment. This is just a quick prototype tool leveraging JSPM's dev hosted servers that allow us to use import to load packages via NPM through their servers. Thank you JSPM.</p>
</blockquote>
<ol start="3">
<li>Now we can do some browser-specific steps to get mocha to run.</li>
</ol>
<pre><code class="language-diff">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;div id="mocha"&gt;&lt;/div&gt;
  &lt;script type="module"&gt;
    import "https://dev.jspm.io/mocha"
<span class="hljs-deletion">-    console.log("Mocha:", Mocha);</span>
<span class="hljs-addition">+    mocha.setup('bdd');</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    mocha.run();</span>
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ol start="4">
<li>Let's add some tests.</li>
</ol>
<pre><code class="language-diff">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;div id="mocha"&gt;&lt;/div&gt;
  &lt;script type="module"&gt;
    import "https://dev.jspm.io/mocha"
    mocha.setup('bdd');

<span class="hljs-addition">+    describe("some awesome tests", function () {</span>
<span class="hljs-addition">+        it("Should pass", function (){</span>
<span class="hljs-addition">+            console.log("passing test");</span>
<span class="hljs-addition">+        });</span>
<span class="hljs-addition">+        it("Should fail", function (){</span>
<span class="hljs-addition">+            throw new Error("OH NO!!!");</span>
<span class="hljs-addition">+        });</span>
<span class="hljs-addition">+    });</span>

    mocha.run();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>THAT'S IT - using almost nothing but our browser's capabilities (and maybe a complicated JSPM back-end tool) we can easily write some in-browser tests to spike something, or just play around.</p>
<ol start="5">
<li>But wait - this looks like meh</li>
</ol>
<p>That's true, let's bring in some styles</p>
<pre><code class="language-diff">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;div id="mocha"&gt;&lt;/div&gt;
<span class="hljs-addition">+  &lt;link rel="stylesheet" href="https://dev.jspm.io/mocha/mocha.css"&gt;</span>
  &lt;script type="module"&gt;
    import "https://dev.jspm.io/mocha"
    mocha.setup('bdd');

    describe("some awesome tests", function () {
        it("Should pass", function (){
            console.log("passing test");
        });
        it("Should fail", function (){
            throw new Error("OH NO!!!");
        });
    });

    mocha.run();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p>NOTE: Prob better to use a CDN version instead of pounding JSPM servers (sorry).</p>
</blockquote>
<h1>Final</h1>
<pre><code>
<span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mocha"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"https://dev.jspm.io/mocha/mocha.css"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"module"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">import</span> <span class="hljs-string">"https://dev.jspm.io/mocha"</span>
    mocha.setup(<span class="hljs-string">'bdd'</span>);

    describe(<span class="hljs-string">"some awesome tests"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        it(<span class="hljs-string">"Should pass"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"passing test"</span>);
        });
        it(<span class="hljs-string">"Should fail"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"OH NO!!!"</span>);
        });
    });

    mocha.run();
  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>Cake!</p>
<p>I've done this a few times lately, and am almost able to do it without looking up api and syntax O_O. I also don't need webpack, gulp, servers, or anything but a wee-bit of html/js and some luck (that JSPM servers will hang in there).</p>
<p>Happy Testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/11/testing-asyncronous-code-with-mochajs-and-es7-async-await/">Testing Asynchronous Code with MochaJS and ES7 async/await</a></h1>
    <p class="meta">
          <time datetime="2015-11-12T02:59:21.475Z" pubdate data-updated="true">Nov 11th 2015</time>


        <a href="/2015/11/testing-asyncronous-code-with-mochajs-and-es7-async-await/#disqus_thread" data-disqus-identifier="/2015/11/testing-asyncronous-code-with-mochajs-and-es7-async-await/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>A JavaScript project I'm working on recently underwent a pretty good refactor. Many of the modules/methods in the application worked in a synchronous fashion which meant their unit tests were also generally synchronous. This was great because synchronous code is pretty much always easier to test since they're simpler and easier to reason about.</p>
<p>However, even though I new early on that I would likely have to turn a good number of my synchronous methods into asynchronous ones I tried holding off on that as long as absolutely necessary. I was in a mode of prototyping as much of the application out as possible before I wanted to be worried/thinking about asynchronous aspects of the code base.</p>
<p>Part of why I held of on this was because I was pretty confident using the new proposed ES7 <code>async/await</code> syntax to turn the sync code into async code relatively easily. While there were a few bumps along the refactor actually went extremely well.</p>
<p>An example of one bump I ran into included replacing <code>items.forEach(item =&gt; item.doSomethingNowThatWillBecomeAsyncSoon())</code> with something that worked asynchronously and I found <a href="http://pouchdb.com/2015/03/05/taming-the-async-beast-with-es7.html">this blog post</a> immensely helpful. Basically, don't try to await a <code>forEach</code> instead build a list of promises you can await.</p>
<p>Another one I ran into was dealing with async mocha tests, which is what the rest of this post is about.</p>
<p><a href="https://mochajs.org">MochaJS</a> is great because the asynchronous testing has been there from the beginning. If you've <code>done</code> (see what I did there?) any asynchronous testing with MochaJS then you already know that you can signal to Mocha an asynchronous test is <code>done</code> by calling the test's async callback method.</p>
<p>Before we look at how to test asynchronous Mocha tests leveraging the new ES 7 async/await syntax, let's first take a little journey through some of the various asynchronous testing options with Mocha.</p>
<blockquote>
<p>Note: you will see example unit tests that use the <code>expect(...).to.equal(...)</code> style assertions from <a href="http://chaijs.com/api/bdd/">ChaiJS</a>.</p>
</blockquote>
<h1>How to create an asynchronous MochaJS test?</h1>
<p>If you look at a normal synchronous test:</p>
<pre><code>it(<span class="hljs-string">"should work"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Synchronous test"</span>);
});
</code></pre>
<p>all we have to do to turn it into an asynchronous test is to add a callback function as the first parameter in the mocha test function (I like to call it <code>done</code>) like this</p>
<pre><code>it(<span class="hljs-string">"should work"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>)</span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Synchronous test"</span>);
});
</code></pre>
<p>But that's an invalid asynchronous test.</p>
<h1>Invalid basic async mocha test</h1>
<p>This first async example test we show is invalid because the <code>done</code> callback is never called. Here's another example using <code>setTimeout</code> to simulate proper asynchronicity. This will show up in Mocha as a timeout error because we never signal back to mocha by calling our <code>done</code> method.</p>
<pre><code>it(<span class="hljs-string">"where we forget the done() callback!"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>)</span>{
    setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Test"</span>);
    }, <span class="hljs-number">200</span>);
});
</code></pre>
<h1>Valid basic async mocha test</h1>
<p>When we call the <code>done</code> method it tells Mocha the asynchronous work/test is complete.</p>
<pre><code>it<span class="hljs-list">(<span class="hljs-string">"Using setTimeout to simulate asynchronous code!"</span>, function<span class="hljs-list">(<span class="hljs-keyword">done</span>)</span>{
    setTimeout<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">()</span> {
        done<span class="hljs-list">()</span><span class="hljs-comment">;</span>
    }, <span class="hljs-number">200</span>)</span><span class="hljs-comment">;</span>
})</span><span class="hljs-comment">;</span>
</code></pre>
<h1>Valid basic async mocha test (that fails)</h1>
<p>With asynchronous tests, the way we tell Mocha the test failed is by passing an <code>Error</code> or <code>string</code> to the <code>done(...)</code> callback</p>
<pre><code>it<span class="hljs-list">(<span class="hljs-string">"Using setTimeout to simulate asynchronous code!"</span>, function<span class="hljs-list">(<span class="hljs-keyword">done</span>)</span>{
    setTimeout<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">()</span> {
        done<span class="hljs-list">(<span class="hljs-keyword">new</span> Error<span class="hljs-list">(<span class="hljs-string">"This is a sample failing async test"</span>)</span>)</span><span class="hljs-comment">;</span>
    }, <span class="hljs-number">200</span>)</span><span class="hljs-comment">;</span>
})</span><span class="hljs-comment">;</span>
</code></pre>
<h1>Invalid async with Promise mocha test</h1>
<p>If you were to run the below test it would fail with a timeout error.</p>
<pre><code>it(<span class="hljs-string">"Using a Promise that resolves successfully!"</span>, function(done) {
    <span class="hljs-keyword">var</span> testPromise = new <span class="hljs-type">Promise</span>(function(resolve, reject) {
        setTimeout(function() {
            resolve(<span class="hljs-string">"Hello!"</span>);
        }, <span class="hljs-number">200</span>);
    });

    testPromise.then(function(<span class="hljs-literal">result</span>) {
        expect(<span class="hljs-literal">result</span>).to.equal(<span class="hljs-string">"Hello World!"</span>);
        done();
    }, done);
});
</code></pre>
<p>If you were to open up your developer tools you may notice an error printed to the console:</p>
<pre><code>    <span class="hljs-tag">Uncaught</span> (in promise) <span class="hljs-tag">i</span> {<span class="hljs-attribute">message</span>: <span class="hljs-string">"expected 'Hello!' to equal 'Hello World!'"</span>, <span class="hljs-attribute">showDiff</span>: true, <span class="hljs-attribute">actual</span>: <span class="hljs-string">"Hello!"</span>, <span class="hljs-attribute">expected</span>: <span class="hljs-string">"Hello World!"</span>}
</code></pre>
<p>The problem here is the <code>expect(result).to.equal(&quot;Hello World!&quot;);</code> above will fail before we can signal to Mocha via the <code>done()</code> of either an error or a completion which causes a timeout.</p>
<p>We can update the above test with a <code>try/catch</code> around our expectations that could throw exceptions so that we can report any errors to Mocha if they happened.</p>
<pre><code>it<span class="hljs-list">(<span class="hljs-string">"Using a Promise that resolves successfully with wrong expectation!"</span>, function<span class="hljs-list">(<span class="hljs-keyword">done</span>)</span> {
    var testPromise = new Promise<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">resolve</span>, reject)</span> {
        setTimeout<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">()</span> {
            resolve<span class="hljs-list">(<span class="hljs-string">"Hello World!"</span>)</span><span class="hljs-comment">;</span>
        }, <span class="hljs-number">200</span>)</span><span class="hljs-comment">;</span>
    })</span><span class="hljs-comment">;</span>

    testPromise.then<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">(<span class="hljs-keyword">result</span>)</span>{
        try {
            expect<span class="hljs-list">(<span class="hljs-keyword">result</span>)</span>.to.equal<span class="hljs-list">(<span class="hljs-string">"Hello!"</span>)</span><span class="hljs-comment">;</span>
            done<span class="hljs-list">()</span><span class="hljs-comment">;</span>
        } catch<span class="hljs-list">(<span class="hljs-keyword">err</span>)</span> {
            done<span class="hljs-list">(<span class="hljs-keyword">err</span>)</span><span class="hljs-comment">;</span>
        }
    }, done)</span><span class="hljs-comment">;</span>
})</span><span class="hljs-comment">;</span>
</code></pre>
<p>This will correctly report the error in the test.</p>
<h2>But there is a better way with promises. (mostly)</h2>
<p>Mocha has built-in support for async tests that return a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>. However, run into troubles with async and promises in the hook functions like <code>before/beforEach/etc...</code>. So if you keep reading you'll see a helper function that I've not had any issues with (besides it's a bit more work...).</p>
<blockquote>
<p>Thanks to a comment from @syrnick below, I've extended this write-up...</p>
</blockquote>
<p>Async tests can be accomplished in two ways. The first is the already shown <code>done</code> callback. The second is if you returned a <code>Promise</code> object from the test. This a great building block. The above example test has become a little verbose with all the usages of <code>done</code> and the <code>try/catch</code> - it just gets a little cumbersome to write.</p>
<p>If we wanted to re-write the above test we can simplify it to return just promise.</p>
<blockquote>
<p>IMPORTANT: if you want to return a promise, you have to remove the <code>done</code> callback or mocha will assume you'll be using that first and not look for a promise return. Although I've seen comments in Mocha's github issues list where some people depend on it working with both a callback and a promise - your mileage may vary.</p>
</blockquote>
<p>Here's an example of returning a <code>Promise</code> that correctly fails the test with the readable error message from Chaijs.</p>
<pre><code>it(<span class="hljs-string">"Using a Promise that resolves successfully with wrong expectation!"</span>, function() {
    <span class="hljs-keyword">var</span> testPromise = new <span class="hljs-type">Promise</span>(function(resolve, reject) {
        setTimeout(function() {
            resolve(<span class="hljs-string">"Hello World!"</span>);
        }, <span class="hljs-number">200</span>);
    });

    <span class="hljs-keyword">return</span> testPromise.then(function(<span class="hljs-literal">result</span>){
        expect(<span class="hljs-literal">result</span>).to.equal(<span class="hljs-string">"Hello!"</span>);
    });
});
</code></pre>
<p>The great thing here is we can remove the second <code>error</code> promise callback (where we passed in <code>done</code>) as Mocha should catch any Promise rejections and fail the test for us.</p>
<p>Running the above test will result in the following easy to understand error message:</p>
<p><code>AssertionError: expected 'Hello!' to equal 'Hello World!'</code></p>
<h1>Turn what we know above into async/await.</h1>
<p>Now that we know there are some special things we need to do in our async mocha tests (<code>done</code> callbacks and <code>try/catch</code> or <code>Promise</code>s) let's see what happens if we start to use the new ES7 async/await syntax in the language and if it can enable more readable asynchronous unit tests.</p>
<p>The beauty of the async/await syntax is we get to reduce the <code>.then(callback, done)</code>... mumbo jumbo and turn that into code that reads like it were happening synchronously. The downside of this approach is that it's not happening synchronously and we can't forget that when we're looking at code and starting to use it this way. But overall it is generally easier to reason about in this style.</p>
<p>The big changes from the above <code>Promise</code> style test and the transformed <code>async</code> test below are:</p>
<ol>
<li>Place the <code>async</code> word in front of the <code>async function(done){...</code>. This tells the system that inside of this function there may (or may not be) the use of the <code>await</code> keyword and in the end the function is turned into a <code>Promise</code> under the hood.
a Promise to simplify our unit tests.</li>
<li>We replace the <code>.then(function(result){</code> promise work and in place use the <code>await</code> keyword to have it return the promise value assign it to <code>result</code> so after that we can run our expectations against it.</li>
<li>Remove the <code>done</code> callback. If you aren't aware, <code>async/await</code> is a fancy compiler trick that under-the-hood turns the code into simple <code>Promise</code> chaining and callbacks. So we can use what we learned above about Mocha using 5. <code>return</code> the Promise.</li>
</ol>
<p>If we apply the 5 notes listed above, we see that we can greatly improve the test readability.</p>
<pre><code>it(<span class="hljs-string">"Using a Promise with async/await that resolves successfully with wrong expectation!"</span>, async function() {
    <span class="hljs-keyword">var</span> testPromise = new <span class="hljs-type">Promise</span>(function(resolve, reject) {
        setTimeout(function() {
            resolve(<span class="hljs-string">"Hello World!"</span>);
        }, <span class="hljs-number">200</span>);
    });

    <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = await testPromise;

    expect(<span class="hljs-literal">result</span>).to.equal(<span class="hljs-string">"Hello!"</span>);
});
</code></pre>
<p>Notice the <code>async function(){</code> part above turns this into a function that will (under-the-hood) return a promise that should correclty report errors when the <code>expect(...)</code> fails.</p>
<h1>Handling errors with <code>async/await</code></h1>
<p>One interesting implementation detail around async await is that exceptions and errors are handled just like you were to handle them in synchronous code using a <code>try/catch</code>. While under-the-hood the errors turn into <code>rejected</code> <code>Promises</code>.</p>
<blockquote>
<p>NOTE: You're mileage may vary with the async/await and mocha tests with promises. I tried playing around with <code>async</code> in mocha hooks like <code>before/beforeEach</code> but ran into some troubles.</p>
</blockquote>
<p>Since there may or may-not be issues with mocha hook methods, one work-around is to leverage a <code>try/catch</code> and the <code>done</code> callback to manually handle exceptions. You may run into this so I'll show examples of how to avoid relying on Mocha to trap errors.</p>
<p>Below shows the (failing) but alternative way (not using a <code>return Promsie</code>) but using the <code>done</code> callback instead.</p>
<pre><code>it(<span class="hljs-string">"Using a Promise with async/await that resolves successfully with wrong expectation!"</span>, async function(done) {
    <span class="hljs-keyword">var</span> testPromise = new <span class="hljs-type">Promise</span>(function(resolve, reject) {
        setTimeout(function() {
            resolve(<span class="hljs-string">"Hello World!"</span>);
        }, <span class="hljs-number">200</span>);
    });

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = await testPromise;

        expect(<span class="hljs-literal">result</span>).to.equal(<span class="hljs-string">"Hello!"</span>);

        done();
    } catch(err) {
        done(err);
    }
});
</code></pre>
<h1>Removing the test boilerplate</h1>
<p>One I started seeing the pattern and use of <code>try/catch</code> boilerplate showing up in my async tests, it became apparent that there had to be a more terse approach that could help me avoid forgetting the <code>try/catch</code> needed in each async test. This was because I would often remember the <code>async/await</code> syntax changes for my async tests but would often forget the <code>try/catch</code> which often resulted in timeout errors instead of proper failures.</p>
<blockquote>
<p>another example below with the async/await and try/catch</p>
</blockquote>
<pre><code>it(<span class="hljs-string">"Using an async method with async/await!"</span>, async function(done) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = await somethingAsync();

        expect(<span class="hljs-literal">result</span>).to.equal(something);

        done();
    } catch(err) {
        done(err);
    }
});
</code></pre>
<p>So I refactored that to reduce the friction.</p>
<h2>And the mochaAsync higher order function was born</h2>
<p>This simple little guy takes an <code>async</code> function which looks like <code>async () =&gt; {...}</code>. It then returns a higher order function which is also asynchronous but has wrapped your test function in a try/catch and also takes care of calling the mocha <code>done</code> in the proper place (either after your test is asynchronously completed, or errors out).</p>
<pre><code>var mochaAsync = <span class="hljs-function"><span class="hljs-params">(fn)</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> async (done) =&gt; {
        <span class="hljs-keyword">try</span> {
            await fn();
            done();
        } <span class="hljs-keyword">catch</span> (err) {
            done(err);
        }
    };
};
</code></pre>
<p>You can use it like this:</p>
<pre><code>it<span class="hljs-list">(<span class="hljs-string">"Sample async/await mocha test using wrapper"</span>, mochaAsync<span class="hljs-list">(<span class="hljs-keyword">async</span> <span class="hljs-list">()</span> =&gt; {
    var x = await someAsyncMethodToTest<span class="hljs-list">()</span><span class="hljs-comment">;</span>
    expect<span class="hljs-list">(<span class="hljs-keyword">x</span>)</span>.to.equal<span class="hljs-list">(<span class="hljs-keyword">true</span>)</span><span class="hljs-comment">;</span>
})</span>)</span><span class="hljs-comment">;</span>
</code></pre>
<p>It can also be used with the mocha <code>before</code>, <code>beforeEach</code>, <code>after</code>, <code>afterEach</code> setup/teardown methods.</p>
<pre><code>beforeEach<span class="hljs-list">(<span class="hljs-keyword">mochaAsync</span><span class="hljs-list">(<span class="hljs-keyword">async</span> <span class="hljs-list">()</span> =&gt; {
    await someLongSetupCode<span class="hljs-list">()</span><span class="hljs-comment">;</span>
})</span>)</span><span class="hljs-comment">;</span>
</code></pre>
<h1>In closing.</h1>
<p>This post may have seemed like quite a journey to get to the little poorly named <code>mochaAsync</code> or learn to use Mocha's Promise support but I hope it was helpful and I can't wait for the <code>async/await</code> syntax to become mainstream in JavaScript, but until then I'm thankful we have transpiling tools like <a href="http://babeljs.io">Babel</a> so we can take advantage of these features now. ESNext-pecially in our tests...</p>
<p>Happy Testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/10/red--possibly-the-most-important-step-in-red--green--refactor/">Red - Possibly the Most Important Step in Red, Green, Refactor</a></h1>
    <p class="meta">
          <time datetime="2015-10-10T05:24:02.467Z" pubdate data-updated="true">Oct 9th 2015</time>


        <a href="/2015/10/red--possibly-the-most-important-step-in-red--green--refactor/#disqus_thread" data-disqus-identifier="/2015/10/red--possibly-the-most-important-step-in-red--green--refactor/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>If you do any sort of test driven development, you've likely heard of the following steps</p>
<ul>
<li><strong>Red</strong>: In this case means you write a test first and see the <code>red</code> (meaning failing test).</li>
<li><strong>Green</strong>: This is where you actually write a tiny bit of production code to see the red test from above go green and pass.</li>
<li><strong>Refactor</strong>: Now that you have a passing test (or suite of tests) you can presumably safely refactor and apply any common code cleanup practices to the code.</li>
</ul>
<h1>The importance of the Red step.</h1>
<p>I don't want to go in to each of these steps in detail today, but I did want to drill into the <code>Red</code> step by giving you a short little example that happened to me today.</p>
<p>If you are interested in a little more detail on the subject check out:</p>
<ul>
<li><a href="http://www.jamesshore.com/Blog/Red-Green-Refactor.html">http://www.jamesshore.com/Blog/Red-Green-Refactor.html</a></li>
<li><a href="http://blog.cleancoder.com/uncle-bob/2014/12/17/TheCyclesOfTDD.html">http://blog.cleancoder.com/uncle-bob/2014/12/17/TheCyclesOfTDD.html</a></li>
</ul>
<p>If you're new to any sort of <a href="https://en.wikipedia.org/wiki/Test-driven_development">TDD</a>/<a href="https://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a>/anything-DD you may not quite get how important this first step is, but hopefully the rest of this post helps...</p>
<h1>Make sure it fails</h1>
<p>The Red step is one of the most important, but one that a new practitioner may skip out of laziness. It takes discipline to write the failing test, run it and verify that it fails. It is so easy to write the test code AND the production code together, run it and see it pass that skipping the red step is something even seasoned veterans in the field can fall prey to.</p>
<p>However, if you don't see the test fail, how do you know it will ever fail?</p>
<p>I can tell you on numerous occasions in the past where I have written both production code and test code together, run it see it pass, just in case - comment out the production code and STILL see the test pass. Wait what?</p>
<p>If you are not careful you may have created a bad test and if you run this Red step first and you don't see it turn Red, you likely have a problem.</p>
<p>It could be a problem with the test itself, or possibly something you put in the test that is triggering something deeper in the system. It doesn't matter what the problem is, you first need to get the test to turn red before you write any production code to make it turn green.</p>
<h1>Make sure it fails FOR THE RIGHT REASON</h1>
<p>While it's easy to see a red bar and move on, it's also good to review the exact reason it failed. Did you get a <code>FileNotFoundException</code> exception when you were expecting a <code>NullReferenceException</code>? Or did you get an integer value of <code>10</code> when you were thinking at that moment it would have failed because it returned a string?</p>
<p>If you're writing proper tests, your red step will include a true failure case that not only just fails, but fails for the reason you would expect it to fail - at least until you go to write the production code that satisfies the tests intent.</p>
<h1>Now a little example.</h1>
<p>In the example below I was behaving myself and I DID run the red step first. I am using plain-ish JavaScript (I say ish here because I'm using ES6 with babel compiler).</p>
<blockquote>
<p>It's much easier to make the type of mistake I'm going to highlight below with plain JavaScript than if you were using a statically typed language. You can try something like <a href="http://typescriptlang.org">TypeScript</a> for <a href="http://flowtype.org/">flow</a> as these compilers provide a static type checker over your JavaScript. Compilers are a great first test...</p>
</blockquote>
<p>Alas, I'm not doing that at the moment.</p>
<p>So here is what I did...</p>
<p>First I wrote a test:</p>
<pre><code><span class="hljs-keyword">import</span> FeedData <span class="hljs-keyword">from</span> <span class="hljs-string">'../app/feed.js'</span>;

describe(<span class="hljs-string">"feed cache"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> feedCache;

  before(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    feedCache = FeedData.loadCache();
  });

  it(<span class="hljs-string">"Feed Cache should have two items"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    expect(feedCache.length).to.equal(<span class="hljs-number">2</span>);
  });

});

</code></pre>
<p>When I tried to run it I got the error saying that <code>TypeError: FeedData.loadCache is not a function</code>. This was great and made total sense because I haven't written this <code>loadCache()</code> function yet.</p>
<p>Next I opened up my <code>FeedData.js</code> file and added the <code>loadCache()</code> function.</p>
<pre><code><span class="hljs-literal">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeedData</span> </span>{
  loadCache() {

  }
}
</code></pre>
<p>I left the implementation blank for now and re-ran my tests. Same error <code>TypeError: FeedData.loadCache is not a function</code> as above.</p>
<p>That was odd, because I know I added the function but apparently it didn't think I had... some scratching... looking... hmm... Ahh ha - I had imported from <code>feed.js</code> not <code>feedData.js</code>.</p>
<p>It's subtle, but in my app <code>feedData</code> and <code>feed</code> are different things. So I moved the function to the correct ES6 class and re-ran the tests. I was <strong>certain</strong> this time that it may fail but at least fail for the right reason (not a missing function).</p>
<p>ARGGG....</p>
<p>Again I got the same error <code>TypeError: FeedData.loadCache is not a function</code>. Ok, that was weird. Now I'm wondering if I have a caching problem in my browser, but before I try to debug Chrome's caching (kidding there, if I ever have to go that far I'm really having a rough day) I better have another look at my code.</p>
<p>It didn't take long in this case to realize where my issue was. <code>FeedData</code> is an ES6 class and I'm calling what I thought was a static function on the class from within the test, however it wasn't declared as static in the implementation.</p>
<p>Adding the <code>static</code> keyword below turned this function into what my test was originally expecting.</p>
<pre><code><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> FeedData {
  <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">loadCache</span><span class="hljs-params">()</span> </span>{

  }
}
</code></pre>
<p>Now, all this work just to get the first part of my <code>red</code> test. What a journey it's been for something as silly as declaring a function.</p>
<p>It was a good reminder just how important the red step in red, green, refactor is.</p>
<p>Happy Testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/10/in-app-unit-test-example-with-jspm--react--winjs-and-mocha/">In App Unit test example with JSPM, React, WinJS and Mocha</a></h1>
    <p class="meta">
          <time datetime="2015-10-08T16:42:00.666Z" pubdate data-updated="true">Oct 8th 2015</time>


        <a href="/2015/10/in-app-unit-test-example-with-jspm--react--winjs-and-mocha/#disqus_thread" data-disqus-identifier="/2015/10/in-app-unit-test-example-with-jspm--react--winjs-and-mocha/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>A while back I wrote about <a href="https://staxmanade.com/2015/03/in-app-unit-tests/">In App Unit Tests</a> and have been having too much fun creating little <a href="https://staxmanade.com/2015/09/jsmp-systemjs-starter-plunker/">starter plunks</a> on <a href="http://plnkr.co">Plunker</a>. So...</p>
<p>As a simple demonstration on in-app unit tests I've thrown together a little plunk that shows <a href="https://staxmanade.com/2015/03/in-app-unit-tests/">in-app tests</a> within the a <a href="https://github.com/winjs/winjs">WinJS</a> <a href="https://msdn.microsoft.com/en-us/library/windows/apps/dn624879.aspx">Pivot</a>. And add to the layers of abstraction I'm using <a href="https://github.com/winjs/react-winjs">react-winjs</a> which I'm LOVING over normal WinJS development.</p>
<h1>Link to: <a href="http://plnkr.co/edit/feKPEx?p=preview">JSPM/React/WinJS/Mocha Plunk</a></h1>
<p>If you like this starter, I have it and a few more linked here: <a href="https://staxmanade.com/2015/09/jsmp-systemjs-starter-plunker/">for re-use</a></p>
<p>I'd like to highlight <a href="http://plnkr.co/edit/feKPEx?p=preview">this particular starter</a> at bit more in this post, not only because there are a few more concepts to this basic plunk, but also because I'm fairly happy with the MochaJS React component that I've now copied around and re-used a few times in some small projects where use <a href="https://staxmanade.com/2015/03/in-app-unit-tests/">In App Unit Tests</a>.</p>
<h1>Plunker file overview</h1>
<ul>
<li><code>index.html</code> - The index file is a very basic <a href="http://jspm.io">JSPM</a> bootstrap page that loads the <code>app.jsx</code> react component.</li>
<li><code>app.jsx</code> - Defines a WinJS Pivot control where we render the in-app <code>MochaTests.jsx</code> React component. This also defines the test file(s) and using MochaJS's global detection we can tell the react <code>MochaTests</code> component what test files to load and run as well as what globals are allowed to exist.</li>
<li><code>config.js</code> - This is JSPM's config that defines what version of React we're using and to use <code>babel</code> for transpilation.</li>
<li><code>tests.js</code> - is our Mocha set of unit tests. We can have multiple test files if we want, just have to define what files to load in <code>app.jsx</code>.</li>
</ul>
<p>Lastly the <code>MochaTests.jsx</code> which I'll include the full component below:</p>
<blockquote>
<p>easier to copy-paste inherit for myself in the future</p>
</blockquote>
<pre><code><span class="hljs-keyword">import</span> mocha <span class="hljs-keyword">from</span> <span class="hljs-string">'mocha'</span>;
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MochaTests</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{

    static get propTypes() {
        <span class="hljs-keyword">return</span> {
            testScripts: React.PropTypes.array.isRequired,
            allowedGlobals: React.PropTypes.array
        };
    }

    constructor(props) {
        <span class="hljs-keyword">super</span>(props);
    }

    componentDidMount() {

        <span class="hljs-keyword">var</span> testScripts = <span class="hljs-keyword">this</span>.props.testScripts;
        <span class="hljs-keyword">var</span> runTests = <span class="hljs-keyword">this</span>.runTests.bind(<span class="hljs-keyword">this</span>);

        <span class="hljs-comment">// for some reason importing mocha with JSPM and ES6 doesn't</span>
        <span class="hljs-comment">// place the mocha globals on the window object. The below</span>
        <span class="hljs-comment">// handles that for us - as well as setting up the rest of the</span>
        <span class="hljs-comment">// test scripts for the first run</span>
        mocha.suite.on(<span class="hljs-string">'pre-require'</span>, context =&gt; {
            <span class="hljs-keyword">var</span> exports = <span class="hljs-built_in">window</span>;

            exports.afterEach = context.afterEach || context.teardown;
            exports.after = context.after || context.suiteTeardown;
            exports.beforeEach = context.beforeEach || context.setup;
            exports.before = context.before || context.suiteSetup;
            exports.describe = context.describe || context.suite;
            exports.it = context.it || context.test;
            exports.setup = context.setup || context.beforeEach;
            exports.suiteSetup = context.suiteSetup || context.before;
            exports.suiteTeardown = context.suiteTeardown || context.after;
            exports.suite = context.suite || context.describe;
            exports.teardown = context.teardown || context.afterEach;
            exports.test = context.test || context.it;
            exports.run = context.run;

            <span class="hljs-comment">// now use SystemJS to load all test files</span>
            <span class="hljs-built_in">Promise</span>
            .all(testScripts.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">testScript</span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Adding Mocha Test File: "</span>, testScript);
                <span class="hljs-keyword">return</span> System.import(testScript);
            })).then(runTests, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Error loading test modules"</span>);
                <span class="hljs-built_in">console</span>.error(err);
            });

        });
        mocha.setup(<span class="hljs-string">'bdd'</span>);
    }

    runTests() {
        <span class="hljs-keyword">var</span> allowedGlobals = <span class="hljs-keyword">this</span>.props.allowedGlobals || [];

        <span class="hljs-keyword">this</span>.refs.mocha.getDOMNode().innerHTML = <span class="hljs-string">""</span>;

        mocha.checkLeaks();
        mocha.globals(allowedGlobals);
        mocha.run();

    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css"><span class="hljs-rules">{"\
                  #mocha-stats em { \
                      <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> inherit</span></span>; \
                  }</span> \
                  <span class="hljs-id">#mocha-stats</span> <span class="hljs-rules">{ \
                    <span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value"> inherit</span></span>; \
                  }</span>\
                  <span class="hljs-id">#mocha</span> <span class="hljs-class">.test</span><span class="hljs-class">.fail</span> <span class="hljs-tag">pre</span> <span class="hljs-rules">{ \
                      <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> red</span></span>; \
                  }</span> \
                "}</span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">{this.runTests.bind(this)}</span>&gt;</span>Rerun Tests<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mocha"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mocha"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        )</span>;
    }
}
</code></pre>
<p>Usage example of this React <code>MochaTests</code> component.</p>
<pre><code>// <span class="hljs-type">Define</span> what test files get loaded by the <span class="hljs-type">MochaTests</span> component
<span class="hljs-keyword">var</span> testScripts = [
  './tests.js'
];


<span class="hljs-keyword">var</span> allowedTestGlobals = [
  // <span class="hljs-type">Declare</span> what globals are allowed to be created during <span class="hljs-type">any</span> test runs.
];


// <span class="hljs-type">Usage</span> <span class="hljs-keyword">of</span> <span class="hljs-type">MochaTests</span> <span class="hljs-keyword">in</span> a react render() <span class="hljs-keyword">method</span>.
&lt;<span class="hljs-type">MochaTests</span> testScripts={testScripts} allowedGlobals={allowedTestGlobals} /&gt;

</code></pre>
<p>I'm not expecting to see a large up-tick in WinJS apps out there with in-app unit tests that run in the browser, however hopefully the <code>MochaTests.jsx</code> React Component is of value to you and can be utilized outside of WinJS within almost any React app.</p>
<p>Please drop a line if you end up using it or if it can be adapted. If there's value in the component, maybe</p>
<h1>Known Issue</h1>
<p>If the number of tests starts to go beyond the height of the pivot in this sample, it has an issue where the WinJS Pivot cuts off at the bottom not allowing you to scroll and see the rest of the test output. I haven't dug into it yet because I've been clicking the <code>failures: X</code> link and it filters the U.I. to just the erroring tests.</p>
<p>If you happen to come up with a good solution, drop me a note - I'd love it. Thanks in advance!</p>
<p>Happy Testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/09/jsmp-systemjs-starter-plunker/">JSMP/SystemJS Starter Plunker</a></h1>
    <p class="meta">
          <time datetime="2015-09-09T05:35:11.207Z" pubdate data-updated="true">Sep 8th 2015</time>


        <a href="/2015/09/jsmp-systemjs-starter-plunker/#disqus_thread" data-disqus-identifier="/2015/09/jsmp-systemjs-starter-plunker/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I'm writing this post more for myself as a quick way to get going with JSPM, but if you find it useful please feel free.</p>
<p>Since I've recently been playing with <a href="http://jspm.io">JSPM</a>, I've found it useful to kick-start my prototyping with a plunk. I've created a number of starter plunks below (and continue to add to the list.</p>
<h1>Full list of JSPM starter plunks</h1>
<h2><a href="http://plnkr.co/edit/RwUyLb?p=preview">JSPM Starter</a></h2>
<h2><a href="http://plnkr.co/edit/XWVTSx?p=preview">JSPM, React</a></h2>
<h2><a href="http://plnkr.co/edit/LLQQqg?p=preview">JSPM, MochaJS</a></h2>
<h2><a href="http://plnkr.co/edit/TFbsNJ?p=preview">JSPM, React, MochaJS</a></h2>
<h2><a href="http://plnkr.co/edit/QPDetQ?p=preview">JSPM, React, MochaJS, (Sample jsx Component test)</a></h2>
<h2><a href="http://plnkr.co/edit/XKrZHJ?p=preview">JSPM, React, WinJS</a></h2>
<h2><a href="http://plnkr.co/edit/feKPEx?p=preview">JSPM, React, WinJS, MochaJS</a></h2>
<hr>
<h1>How to use:</h1>
<ol>
<li>Click one of the links above</li>
<li>Review the various files. Open and edit the <code>app.js</code> file</li>
<li>Start writing code!</li>
</ol>
<blockquote>
<p>Be sure to open your developer tools and monitor any console output for errors...</p>
</blockquote>
<p>If you want to take more of a test driven approach to your prototype take a look at <a href="https://staxmanade.com/2015/09/browser-only-mochajs-tests-using-systemjs/">MochaJS with JSPM</a> or go directly to the <a href="http://plnkr.co/edit/LLQQqg?p=preview">JSPM/MochaJS Plunk</a></p>
<p>Happy Prototyping!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/09/browser-only-mochajs-tests-using-systemjs/">Browser only MochaJS tests using SystemJS</a></h1>
    <p class="meta">
          <time datetime="2015-09-04T22:41:38.170Z" pubdate data-updated="true">Sep 4th 2015</time>


        <a href="/2015/09/browser-only-mochajs-tests-using-systemjs/#disqus_thread" data-disqus-identifier="/2015/09/browser-only-mochajs-tests-using-systemjs/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I've been poking at <a href="https://github.com/systemjs/systemjs">SystemJS</a> (you may have heard of it through <a href="http://jspm.io">JSPM</a>) and one of the first things I like to setup when playing with a new JS framework is a way to run <a href="https://mochajs.org">MochaJS</a> unit tests which allow me to test-drive my prototypes and in this case the best part is we don't have to do any local command line installations or crazy gulp/grunt builds. We can right in the browser start writing plain ES6 and prototype using a library from <a href="https://npmjs.org">npm</a> or <a href="https://github.com">github</a>.</p>
<p>SystemJS is a very exciting project with it's ability to import modules/code right from your JS code itself. You can write your JS using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">ES6 import</a> syntax and in many cases SystemJS will magically import code via NPM or GitHub directly.</p>
<h1>TL;DR</h1>
<p>If you want to skip the details below and just see the <a href="http://plnkr.co/edit/LLQQqg?p=preview">plnkr.co</a> go right ahead!</p>
<h1>How to run our first Mocha test</h1>
<p>First we need to get a simple web page setup. I'm going to use <a href="http://plnkr.co/">plnkr.co</a> as it allows me to specify multiple files. This will allow me to more easily componentize my code for cleaner extraction into a project, gist or other...</p>
<p>Once you have a basic Plunker setup go ahead and delete everything except <code>index.html</code> of for now.</p>
<p>Now we're ready to start throwing our code in here... But before you do open your browser's developer tools. I'm using Chrome on the Mac so <code>Cmd+Option+j</code> will do it. We need to be able to see the javascript console in case we see any errors with SystemJS loading of modules.</p>
<p><code>index.html</code> &lt;- paste the below in for you're Plunker <code>index.html</code>.</p>
<pre><code><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://jspm.io/system@0.18.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="actionscript">
    System.<span class="hljs-keyword">import</span>(<span class="hljs-string">'./testInit.js'</span>);
  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<p>With the above in the <code>index.html</code> you should see some errors printed to the console as SystemJS is trying to load <code>./testInit.js</code> (but we haven't created it yet).</p>
<p>Before we create the <code>testInit.js</code> file let's first create a couple sample MochaJS test files that we want to test.</p>
<p>Here's our first test file: name it <code>mochaTest1.js</code></p>
<p>Something cool about this test is once we get mocha wired up correctly, this test shows how seamlessly you can take a dependency on a 3rd party library like <a href="http://chaijs.com/">chaijs</a> for help with assertions.</p>
<pre><code><span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'chai'</span>;

describe(<span class="hljs-string">"This is a describe"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  it(<span class="hljs-string">"sample test that should pass"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    expect(<span class="hljs-literal">true</span>).to.equal(<span class="hljs-literal">true</span>);
  });
  it(<span class="hljs-string">"sample test that should fail"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    expect(<span class="hljs-literal">true</span>).to.equal(<span class="hljs-literal">false</span>);
  });
});
</code></pre>
<p>Create another test file <code>mochaTest2.js</code></p>
<pre><code><span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'chai'</span>;

describe(<span class="hljs-string">"This is another describe"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  it(<span class="hljs-string">"sample test that should pass"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    expect(<span class="hljs-literal">true</span>).to.equal(<span class="hljs-literal">true</span>);
  });
  it(<span class="hljs-string">"sample test that should fail"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    expect(<span class="hljs-literal">true</span>).to.equal(<span class="hljs-literal">false</span>);
  });
});
</code></pre>
<p>Creating two test files allows this sample to show how you can easily create and test multiple modules.</p>
<h1>The meat and potatoes</h1>
<p>Now is the juicy part on how to get Mocha to play nicely with this setup and run our tests.</p>
<p>Create a file and call it <code>testInit.js</code> (same as we named in our <code>index.html</code> and referenced it via <code>System.import('./testInit.js')</code>) and paste the below.</p>
<p>Feel free to read through it as I commented it thoroughly.</p>
<pre><code><span class="hljs-comment">//</span>
<span class="hljs-comment">// This tells SystemJS to load the mocha library</span>
<span class="hljs-comment">// and allows us to interact with the library below.</span>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">import</span> mocha <span class="hljs-keyword">from</span> <span class="hljs-string">'mocha'</span>;

<span class="hljs-comment">//</span>
<span class="hljs-comment">// This defines the list of test files we want to load and run tests against.</span>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">var</span> mochaTestScripts = [
  <span class="hljs-string">'./mochaTest1.js'</span>,
  <span class="hljs-string">'./mochaTest2.js'</span>
];

<span class="hljs-comment">//</span>
<span class="hljs-comment">// If you have a global or two that get exposed from your</span>
<span class="hljs-comment">// tests that is expected you can include them here</span>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">var</span> allowedMochaGlobals = [
  <span class="hljs-string">'jQuery'</span>
]


<span class="hljs-comment">//</span>
<span class="hljs-comment">// Mocha needs a &lt;div id="mocha"&gt;&lt;/div&gt; for the browser</span>
<span class="hljs-comment">// test reporter to inject test results in to the U.I.</span>
<span class="hljs-comment">// Below just injects it at the bottom of the page. (You can get fancy here)</span>
<span class="hljs-comment">// Maybe you create a button in your website and allow anyone to run tests.</span>
<span class="hljs-comment">// Check out https://staxmanade.com/2015/03/in-app-unit-tests/ for more on the thought</span>
<span class="hljs-comment">//</span>
<span class="hljs-keyword">var</span> mochaDiv = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
mochaDiv.id = <span class="hljs-string">"mocha"</span>;
<span class="hljs-built_in">document</span>.body.appendChild(mochaDiv);

<span class="hljs-comment">//</span>
<span class="hljs-comment">// Importing mocha with JSPM and ES6 doesn't expose the usual mocha globals.</span>
<span class="hljs-comment">// I found this is one way to manually expose the globals, however if you know of a better way please let me know...</span>
<span class="hljs-comment">//</span>
mocha.suite.on(<span class="hljs-string">'pre-require'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">context</span>) </span>{
  <span class="hljs-keyword">var</span> exports = <span class="hljs-built_in">window</span>;

  exports.afterEach = context.afterEach || context.teardown;
  exports.after = context.after || context.suiteTeardown;
  exports.beforeEach = context.beforeEach || context.setup;
  exports.before = context.before || context.suiteSetup;
  exports.describe = context.describe || context.suite;
  exports.it = context.it || context.test;
  exports.setup = context.setup || context.beforeEach;
  exports.suiteSetup = context.suiteSetup || context.before;
  exports.suiteTeardown = context.suiteTeardown || context.after;
  exports.suite = context.suite || context.describe;
  exports.teardown = context.teardown || context.afterEach;
  exports.test = context.test || context.it;
  exports.run = context.run;

  <span class="hljs-comment">// now use SystemJS to load all test files</span>
  <span class="hljs-built_in">Promise</span>
    .all(mochaTestScripts.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">testScript</span>) </span>{
      <span class="hljs-keyword">return</span> System.import(testScript);
    })).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      mocha.checkLeaks();
      mocha.globals(allowedMochaGlobals);
      mocha.run();
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Error loading test modules"</span>);
      <span class="hljs-built_in">console</span>.error(err);
    });

});

mocha.setup(<span class="hljs-string">'bdd'</span>);
</code></pre>
<blockquote>
<p>Please let me know if you know of an easier way to get access to the mochas globals using SystemJS. The below works, but is a bit uncomfortable.</p>
</blockquote>
<h1>MochaJS Tests Right in the Browser...</h1>
<p><strong>How awesome is this.</strong> Couple bits of bootstrap code, and we can go author whatever we want right in the browser using ES6 (err EcmaScript 2015) and we're off and running.</p>
<h1><img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> NOT FOR PRODUCTION WORKFLOWS (yet)! <img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"></h1>
<p>This approach is primarily for allowing quick prototyping. Don't implement a complete app like this and then expect any performance. SystemJS can potentially download a large number of dependencies and you should read up on <a href="https://github.com/jspm/jspm-cli/wiki/Production-Workflows">JSPM production workflows</a>.</p>
<p>Happy Browser-Only Testing.</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/05/running-in-app-mocha-tests-within-winjs/">Running in-app mocha tests within WinJS</a></h1>
    <p class="meta">
          <time datetime="2015-05-23T21:32:45.540Z" pubdate data-updated="true">May 23rd 2015</time>


        <a href="/2015/05/running-in-app-mocha-tests-within-winjs/#disqus_thread" data-disqus-identifier="/2015/05/running-in-app-mocha-tests-within-winjs/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><blockquote>
<p>I described a while back a scenario about running <a href="https://staxmanade.com/2015/03/in-app-unit-tests/">in-app unit tests</a>. So if you'd like some background on the subject have a look there before reading here.</p>
</blockquote>
<p>This post is going to give some specifics about how to run <a href="http://mochajs.org/">MochaJS</a> tests within a Microsoft Windows JavaScript application (WinJS).</p>
<h2>Prerequisites</h2>
<p>These steps assume you already have a WinJS application, possibly using the universal template or other. In the end it doesn't matter. As long as you have a project that probably has a <code>default.html</code> file and the ability to add <code>js</code> &amp; <code>css</code> files to.</p>
<h2>Get Mocha</h2>
<p>You can acquire the mocha library however you want, <a href="http://bower.io/">Bower</a>, <a href="http://npmjs.com/">Npm</a>, or download it manually from the site (<a href="http://mochajs.org/">mochajs.org</a>).</p>
<h2>Reference Mocha Within Project &amp; App</h2>
<p>However you get the mocha source, you need to both add references to the mocha js and css files into your project file either in a <code>*.jsproj</code> file or if using a universal shared app, in the shared project.</p>
<p>Then you need to include a reference to the code in your <code>default.html</code> file.</p>
<p>In my example below you can see I used bower to download the <a href="http://mochajs.org">MochaJS</a> library.</p>
<p>The <code>mocha.setup('bdd')</code> tells mocha to use the BDD style of tests which defines the <code>describe(...)</code>, <code>it(...)</code>, etc functions.</p>
<pre><code class="language-html"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>MyApp.Windows<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- WinJS references --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/js/bower_components/winjs/css/ui-light.css"</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/bower_components/winjs/js/base.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/bower_components/winjs/js/ui.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- TESTS--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/js/bower_components/mocha/mocha.css"</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/bower_components/mocha/mocha.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="actionscript">
        mocha.setup(<span class="hljs-string">'bdd'</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- My Project js/css files below... --&gt;</span>

...Rest of default.html file excluded
</code></pre>
<h2>Create a WinJS Control for hosting Mocha reporting.</h2>
<p>Below is a sample WinJS control that can be used to host the mocha html report.</p>
<pre><code class="language-html"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
        <span class="hljs-id">#mocha</span> <span class="hljs-rules">{
            <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">800px</span></span></span>;
            <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">600px</span></span></span>;
            <span class="hljs-rule"><span class="hljs-attribute">overflow</span>:<span class="hljs-value"> scroll</span></span>;
        }</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"fragment section1page"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">section</span> <span class="hljs-attribute">aria-label</span>=<span class="hljs-value">"Main content"</span> <span class="hljs-attribute">role</span>=<span class="hljs-value">"main"</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- define a button that we can use to manually run or re-run tests --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mochaTestsRun"</span>&gt;</span>Run Tests<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- define a checkbox that allow us to toggle auto-run
                 of the tests when we start up the app --&gt;</span>
            Auto start <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"checkbox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mochaTestsRunOnStart"</span> /&gt;</span>


            <span class="hljs-comment">&lt;!-- this is a blank div we use to inject U.I. related tests --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"testElementContainer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- mocha throws the html output in the below div --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mocha"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
<pre><code class="language-javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-pi">    "use strict"</span>;

    <span class="hljs-keyword">var</span> runMochaTests = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// clear any current test results since mocha just appends.</span>
        element.querySelector(<span class="hljs-string">'#mocha'</span>).innerHTML = <span class="hljs-string">""</span>;

        <span class="hljs-comment">// If you want your tests to verify nothing is leaked globally...</span>
        mocha.checkLeaks();

        <span class="hljs-comment">// specify any globals that you are OK with your tests leaking</span>
        mocha.globals([
            <span class="hljs-string">'someGlobalIAmExpecting'</span>
        ]);

        <span class="hljs-comment">// start the test run</span>
        mocha.run();
    }

    <span class="hljs-keyword">var</span> ControlConstructor = WinJS.UI.Pages.define(<span class="hljs-string">"/js/tests/tests.html"</span>, {
        <span class="hljs-comment">// This function is called after the page control contents</span>
        <span class="hljs-comment">// have been loaded, controls have been activated, and</span>
        <span class="hljs-comment">// the resulting elements have been parented to the DOM.</span>
        ready: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element, options</span>) </span>{
            options = options || {};

            <span class="hljs-comment">// get our possibly already cached value of whether to run the tests on startup.</span>
            <span class="hljs-keyword">var</span> runOnStart = (<span class="hljs-built_in">JSON</span>.parse(localStorage.getItem(<span class="hljs-string">"mochaTestsRunOnStart"</span>) || <span class="hljs-string">"true"</span>));

            <span class="hljs-comment">// checkbox to manage auto-run state</span>
            <span class="hljs-keyword">var</span> runOnStartCheckbox = element.querySelector(<span class="hljs-string">'#mochaTestsRunOnStart'</span>);
            runOnStartCheckbox.addEventListener(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                localStorage.setItem(<span class="hljs-string">"mochaTestsRunOnStart"</span>, runOnStartCheckbox.checked);
            });

            <span class="hljs-comment">// button to manually trigger a test run</span>
            <span class="hljs-keyword">var</span> mochaTestsRunButton = element.querySelector(<span class="hljs-string">'#mochaTestsRun'</span>);
            mochaTestsRunButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                runMochaTests();
            })
            runOnStartCheckbox.checked = runOnStart;

            <span class="hljs-keyword">if</span> (runOnStart &amp;&amp; !<span class="hljs-built_in">window</span>.hasRunMochaTestsAtLeastOnce) {
                <span class="hljs-comment">// this value is used to avoid extra test runs as we navigation around the app.</span>
                <span class="hljs-comment">// EX: if the test control is on a home pivot - we nav away and come back home</span>
                <span class="hljs-comment">// we probably don't want to auto-run the tests again. (use the menu button</span>
                <span class="hljs-comment">// instead if you want another test run)</span>
                <span class="hljs-built_in">window</span>.hasRunMochaTestsAtLeastOnce = <span class="hljs-literal">true</span>;
                runMochaTests();
            }

        },
    });

    <span class="hljs-comment">// The following lines expose this control constructor as a global.</span>
    <span class="hljs-comment">// This lets you use the control as a declarative control inside the</span>
    <span class="hljs-comment">// data-win-control attribute.</span>

    WinJS.Namespace.define(<span class="hljs-string">"MyApp.Testing.Controls"</span>, {
        TestsControl: ControlConstructor
    });
})();
</code></pre>
<h2>Handle global exceptions</h2>
<p>If you write any async code (difficult not to these days) an exception or assertion failure will not be trapped by the internal try/catch mechanism's of Mocha in a Windows WinJS environment.</p>
<p>We have to give Mocha a hint on how to hook into global exceptions.</p>
<p>Mocha tries to attach to the browser's global <code>window.onerror</code> method, and since a WinJS app doesn't use this same handler, we have to forward the exceptions and to mocha's attached <code>window.onerror</code> handler.</p>
<p>In your <code>default.js</code> or wherever you configure the <code>app</code> you can attach to the <a href="https://msdn.microsoft.com/en-us/library/windows/apps/hh974768.aspx"><code>WinJS.Application.onerror</code></a> and after some exception massaging we can hand the exceptions to mocha so when a test fails it can be reported correctly.</p>
<pre><code class="language-javascript">    WinJS.Application.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ex</span>) </span>{

        <span class="hljs-keyword">var</span> errorMessage, errorLine, errorUrl;
        <span class="hljs-keyword">if</span> (ex.detail.errorMessage) {
            errorMessage = ex.detail.errorMessage;
            errorLine = ex.detail.errorLine;
            errorUrl = ex.detail.errorUrl;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ex &amp;&amp;
            ex.detail &amp;&amp;
            ex.detail.exception &amp;&amp;
            ex.detail.exception.stack) {
            errorMessage = ex.detail.exception.stack;
            errorLine = <span class="hljs-literal">null</span>;
            errorUrl = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// if window.onerror exists, assume mochajs is here and call it's error handler</span>
        <span class="hljs-comment">// This may be a poor assumption because 3rd party libraries could also attach</span>
        <span class="hljs-comment">// their handlers, but it's working for me so far...</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.onerror &amp;&amp; errorMessage) {
            <span class="hljs-built_in">window</span>.onerror(errorMessage, errorLine, errorUrl);

            <span class="hljs-comment">// return true signalling that the error's been</span>
            <span class="hljs-comment">// handled (keeping the whole app from crashing)</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// if we get here, assuming mochajs isn't running</span>
        <span class="hljs-comment">// let's log out the errors...</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> exMessage = <span class="hljs-built_in">JSON</span>.stringify(ex, <span class="hljs-literal">null</span>, <span class="hljs-string">'  '</span>);
            <span class="hljs-built_in">console</span>.error(exMessage);
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-comment">// can't JSON serialize exception object here (probably circular reference)</span>
            <span class="hljs-comment">// log what we can...</span>
            <span class="hljs-built_in">console</span>.error(ex);
            <span class="hljs-built_in">console</span>.error(e);
        }

        <span class="hljs-comment">// I like to be stopped while debugging to possibly</span>
        <span class="hljs-comment">// poke around and do further inspection</span>
        <span class="hljs-keyword">debugger</span>;
    }
</code></pre>
<h2>Reference the test control.</h2>
<p>While developing out the application, I like to throw it front and center in the first hub of my apps home page hub control.</p>
<p>Here's an example of how to reference the above control:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>hubPage<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/pages/hub/hub.css"</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/js/tests/tests.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>

...page details trimmed for brevity...

            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"hub"</span> <span class="hljs-attribute">data-win-control</span>=<span class="hljs-value">"WinJS.UI.Hub"</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sectionTests"</span>
                     <span class="hljs-attribute">data-win-control</span>=<span class="hljs-value">"WinJS.UI.HubSection"</span>
                     <span class="hljs-attribute">data-win-options</span>=<span class="hljs-value">"{ isHeaderStatic: true }"</span>
                     <span class="hljs-attribute">data-win-res</span>=<span class="hljs-value">"{ winControl: {'header': 'TestSection'} }"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sectionTestscontenthost"</span> <span class="hljs-attribute">data-win-control</span>=<span class="hljs-value">"MyApp.Testing.TestsControl"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

...rest of page details trimmed for brevity...

</code></pre>
<p>If you manage to get everything wired up correctly above, when you run the app (<code>F5</code>) your mocha tests should be all set and run automatically. Oh wait, let's not forget to add a mocha test :)...</p>
<pre><code class="language-javascript">describe(<span class="hljs-string">'Mocha test spike'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    it(<span class="hljs-string">"should report a passing test"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-comment">// doing nothing should be a passing test</span>
    });

    it(<span class="hljs-string">"should fail on a synchronous exception"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some test error to make sure mocha reports a test failure"</span>)
    });

    it(<span class="hljs-string">"should fail on an asynchronous exception"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>)</span>{
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some test error to make sure mocha reports an async test failure"</span>)
            done();
        }, <span class="hljs-number">100</span>);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Some test error to make sure mocha reports a test failure"</span>)
    });

});
</code></pre>
<p>Save the above as your first test file, include it so it runs on startup and verify your tests run and report correctly within the test control.</p>
<p>Happy testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/03/in-app-unit-tests/">In-App Unit Tests</a></h1>
    <p class="meta">
          <time datetime="2015-03-07T06:19:53.583Z" pubdate data-updated="true">Mar 6th 2015</time>


        <a href="/2015/03/in-app-unit-tests/#disqus_thread" data-disqus-identifier="/2015/03/in-app-unit-tests/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>How often do you run your unit tests? Do you even have a test project? Is running your test suite automatic or does it only run when you choose to run them? If the latter is true, then how often do you run them?</p>
<p>For most, running tests is a simple command line tool like <code>gulp test</code> or <code>rake test</code> or a builtin function in your IDE. You may even have your system covered by a Continuous Integration server, or if you want to catch issues earlier possibly even a <a href="https://staxmanade.com/2014/03/rake-psake-grunt-gulp-jake-make-cake/">git pre-commit hook</a>.</p>
<p>One thing we all probably know is the more difficult it is to run your tests, the less often they get run.</p>
<p>What if you're building in an environment that does not allow for easy test automation? What if there are no current command line task runners for the environment you're developing in?</p>
<p>You could spend way too much of your free time/life building a tool that can get the job done for you (cough - <a href="http://statlight.codeplex.com">long live StatLight/Silverlight</a> - cough). I would not necessarily recommend this approach unless you have the spare cycles to contribute a project like this to the broader community.</p>
<p>So, given that there are no external tools to rely on, and you don't want to spend however long it will take to create one for the development environment you are in, how about finding a way to integrate some sort of test run within your existing application?</p>
<p>I have always wanted to setup some unit tests that could run inside of an existing application. If you developed an app that had to ship on lots of devices (thinking android or iOS) and you could ask your users out in the wild to go to the settings page of your app and press a &quot;run tests&quot; button, how awesome would it be if this test run could collect data and send the test results back to you?</p>
<p>This is not a new idea, nor terribly unique, but I've pondered this for quite some time and until recently have not had a project were I was forced to execute on it, until now...</p>
<p>I'm playing with an app that is currently living inside a WinJS (Windows 8) (Metro - err do they call it that anymore?) environment and there are not any CLI tools out there that can be used to automate tests. However, it was easy enough to get <a href="http://mochajs.org/">Mocha</a> running within the app.</p>
<p>With MochaJS in place, I proceeded to setup a WinJS Hub in my hub-based application, after make this testing hub the first hub in my project I now have test that run after every F5 (run) of the application.</p>
<p>This will eventually have to be something I move out of the main landing U.I. when I get closer to shipping my app, but I'm liking the idea of being able to toggle my test U.I. and have them run right within my application, instantly on startup.</p>
<h1>A few benefits of this approach:</h1>
<ul>
<li>It allows me to actually write tests in an application that doesn't natively support a testing runner.</li>
<li>Fewer test gotch-ya's because of environmental reasons</li>
<li>Instant feedback on each run</li>
<li>It's an easy reminder to keep using and driving my development through tests, because the workflow is enabling it (and encouraging it).</li>
<li>(this could be considered a down side but...) since the tests are living within the actual application, I have to be careful to construct my components no to depend too heavily on the environment or configuration as we wouldn't want unit tests to mess up the running application. While it could be seen as a bit of a pain, I'm really liking how this is forcing me to write loosely coupled, highly compossable components that can be easy to swap in/out.</li>
</ul>
<h3>Will I Actually Ship In-App Tests?</h3>
<p>This one is up in the air, but so far I'm of the mind-set that I'll hide the unit-test run from the main hub, place a button deep in some about or setting page and modify the reporter to send send any failed test results, along with some metadata about the environment or system it's running on, like versions, screen size, or whatever is needed...</p>
<p>Happy Testing!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/02/approval-tests---command-line-tool--cli-/">Approval Tests - Command Line Tool (CLI)</a></h1>
    <p class="meta">
          <time datetime="2015-02-08T05:29:48.180Z" pubdate data-updated="true">Feb 7th 2015</time>


        <a href="/2015/02/approval-tests---command-line-tool--cli-/#disqus_thread" data-disqus-identifier="/2015/02/approval-tests---command-line-tool--cli-/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>In <a href="https://staxmanade.com/2015/01/approval-tests---overview/">my previous post</a> I introduced <a href="http://approvaltests.com">Approval Tests</a> using the <a href="https://github.com/approvals/Approvals.NodeJS">Approvals.NodeJS</a> variant of the tool.</p>
<p>In this post I'd like to go over how you can use the command line version of <a href="https://github.com/approvals/Approvals.NodeJS">Approvals.NodeJS</a> for several different scenarios.</p>
<h1>First thing first (How to Install)</h1>
<p>Globally install <code>approvals</code> via <a href="https://www.npmjs.com/">npm</a>.</p>
<pre><code>npm install -g approvals
</code></pre>
<p>Now that you have it installed, let's go over some scenarios that you can use the approvals tool.</p>
<h1>Scenario 1: Compare JSON files downloaded from a web server.</h1>
<p>Let's say you want to see a quick file diff between two api requests.</p>
<p>You can use <code>curl</code> to download the file and pipe (<code>|</code>) it to the <code>approvals</code> CLI tool. We give it a name parameter which is used to generate the file name used to save to.</p>
<p>So if you were to run:</p>
<pre><code>curl <span class="hljs-string">https:</span><span class="hljs-comment">//api.github.com/orgs/approvals | approvals githubOrg</span>
</code></pre>
<p>This would generate two files:</p>
<p><code>githubOrg.received.txt</code> which at the time of this writing would look like:</p>
<pre><code>{
  "<span class="hljs-attribute">login</span>": <span class="hljs-value"><span class="hljs-string">"approvals"</span></span>,
  "<span class="hljs-attribute">id</span>": <span class="hljs-value"><span class="hljs-number">36907</span></span>,
  "<span class="hljs-attribute">url</span>": <span class="hljs-value"><span class="hljs-string">"https://api.github.com/orgs/approvals"</span></span>,
  "<span class="hljs-attribute">repos_url</span>": <span class="hljs-value"><span class="hljs-string">"https://api.github.com/orgs/approvals/repos"</span></span>,
  "<span class="hljs-attribute">events_url</span>": <span class="hljs-value"><span class="hljs-string">"https://api.github.com/orgs/approvals/events"</span></span>,
  "<span class="hljs-attribute">members_url</span>": <span class="hljs-value"><span class="hljs-string">"https://api.github.com/orgs/approvals/members{/member}"</span></span>,
  "<span class="hljs-attribute">public_members_url</span>": <span class="hljs-value"><span class="hljs-string">"https://api.github.com/orgs/approvals/public_members{/member}"</span></span>,
  "<span class="hljs-attribute">avatar_url</span>": <span class="hljs-value"><span class="hljs-string">"https://avatars.githubusercontent.com/u/36907?v=3"</span></span>,
  "<span class="hljs-attribute">description</span>": <span class="hljs-value"><span class="hljs-literal">null</span></span>,
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-literal">null</span></span>,
  "<span class="hljs-attribute">company</span>": <span class="hljs-value"><span class="hljs-literal">null</span></span>,
  "<span class="hljs-attribute">blog</span>": <span class="hljs-value"><span class="hljs-string">"http://approvaltests.com"</span></span>,
  "<span class="hljs-attribute">location</span>": <span class="hljs-value"><span class="hljs-literal">null</span></span>,
  "<span class="hljs-attribute">email</span>": <span class="hljs-value"><span class="hljs-literal">null</span></span>,
  "<span class="hljs-attribute">public_repos</span>": <span class="hljs-value"><span class="hljs-number">13</span></span>,
  "<span class="hljs-attribute">public_gists</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">followers</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">following</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">html_url</span>": <span class="hljs-value"><span class="hljs-string">"https://github.com/approvals"</span></span>,
  "<span class="hljs-attribute">created_at</span>": <span class="hljs-value"><span class="hljs-string">"2008-11-27T06:03:58Z"</span></span>,
  "<span class="hljs-attribute">updated_at</span>": <span class="hljs-value"><span class="hljs-string">"2014-12-28T03:02:33Z"</span></span>,
  "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"Organization"</span>
</span>}
</code></pre>
<p>and an empty <code>githubOrg.approved.txt</code> file.</p>
<p>Note when you first run this command you are prompted with the <code>received</code> file compared to the empty <code>approved</code> files; however, on an initial run, you can use the <code>--forceapproveall</code> argument to avoid the diff step and force all the contents of the <code>received</code> file into the <code>approved</code> file.</p>
<p>Now if the remote file were to change on you and you run the below command again:</p>
<pre><code>curl <span class="hljs-string">https:</span><span class="hljs-comment">//api.github.com/orgs/approvals | approvals githubOrg</span>
</code></pre>
<p>You would get a diff between the the originally <code>approved</code> file and the newly downloaded file.</p>
<h1>Scenario 2:</h1>
<p>Ok, well I actually have another great scenario for using the approvals CLI, but I believe it deserves it's own post as I'm going to introduce some nifty configuration on a Mac that I've used to setup my own development servers automatically.</p>
<p>Until next time...</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2015/01/approval-tests---overview/">Approval Tests - Overview</a></h1>
    <p class="meta">
          <time datetime="2015-01-30T16:38:06.494Z" pubdate data-updated="true">Jan 30th 2015</time>


        <a href="/2015/01/approval-tests---overview/#disqus_thread" data-disqus-identifier="/2015/01/approval-tests---overview/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I first started using the <code>.Net</code> version of Approval Tests and found so much value in it, I <a href="https://github.com/approvals/Approvals.NodeJS">created a port of the tool</a> that I can use in <a href="http://nodejs.org">Node.JS</a>. This post is intended as a rough overview of Approval Tests, and will be using the <a href="https://github.com/approvals/Approvals.NodeJS">NodeJS port</a> in my examples below.</p>
<blockquote>
<p>There is support for other programming languages, so head over to the Approval Tests site at <a href="http://approvaltests.com">ApprovalTests.com</a> and check them out.</p>
</blockquote>
<h2>What are Approval Tests?</h2>
<p>At it's core, Approval Tests are a very different way to execute the assertion step of a unit test.</p>
<p>Think of this as another tool in the bag and not a replacement for the good old fashion <code>assert.equal(...)</code> or your favorite assertion tool. But for certain types of tests, it <strong>IS</strong> the best tool to grab.</p>
<p>Typically, when we create assertions in our unit tests, we assert on very specific things. This property equals that value.</p>
<p>With Approval Tests, you can take whatever output you're wanting to Assert against, turn it into either a string representation or an image (say screenshot of app), and use our favorite diff tool to compare it with the previously <em>approved</em> version.</p>
<p>The diff tool is a great way to visualize change between failing/approved data which can help to raise the level of abstraction of your test. Instead of comparing a single value in an assertion, we can serialize an entire object graph to a string and use the diff tool to review any changes to the diff of the previously approved version.</p>
<p>The work to find and start up your favorite diff tool comparing previously &quot;approved&quot; files is where the <a href="https://approvaltests.com">libraries provided by Approval Tests</a> come in handy.</p>
<h1>Let's walk through an example</h1>
<p>If you've done any testing before, by now you have probably heard of the AAA (Arrange, Act, Assert) style of tests. Below I've contrive a sample test using the AAA style in JavaScript.</p>
<pre><code><span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
describe(<span class="hljs-string">"when testing something"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    it(<span class="hljs-string">"should do something special"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        <span class="hljs-comment">// Arrange</span>
        <span class="hljs-comment">// setup the initial state for the test</span>
        <span class="hljs-keyword">var</span> obj = { valueA: <span class="hljs-string">"test"</span>, valueB: <span class="hljs-number">1234</span> };

        <span class="hljs-comment">// Act - Do some business logic on the object</span>
        obj.valueC = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// Assert - verify the state of the item under test</span>
        assert.equal(obj.valueA, <span class="hljs-string">"test"</span>)
        assert.equal(obj.valueB, <span class="hljs-number">1234</span>);
        assert.equal(obj.valueC, <span class="hljs-literal">true</span>);
    });
});
</code></pre>
<p>At a high level, if you are writing tests with an object, and have a way to translate that object's state into a text or image representation, wouldn't it be great if you could save that state into a file, essentially locking down the state of the test?</p>
<p>This would allow future runs of the test to easily detect a change by comparing the previous state with the new state (strings of course) - but using the power of our diff tools to quickly highlight what is different.</p>
<h1>Let's turn our AAA test above into an Approval Test</h1>
<pre><code class="language-diff">var approvals = require('approvals');
describe("when testing something", function(){
    it("should do something special", function(){

        // Arrange
        // setup the initial state for the test
        var obj = { valueA: "test", valueB: 1234 };

        // Act - Do some business logic on the object
        obj.valueC = true;

        // Assert - verify the state of the item under test
<span class="hljs-deletion">-        assert.equal(obj.valueA, "test")</span>
<span class="hljs-deletion">-        assert.equal(obj.valueB, 1234);</span>
<span class="hljs-deletion">-        assert.equal(obj.valueC, true);</span>
<span class="hljs-addition">+        approvals.verifyAsJSON(__dirname, "sampleTest", obj);</span>
    });
});
</code></pre>
<p>Notice how the 3 <code>assert's</code> turned into 1 <code>approvals.verifyAsJSON</code>?</p>
<h1>How Approval Tests Work</h1>
<p>Approval Tests works by taking the object or value you're trying to verify, serializing it to a text file (or image) and saving it to a file labeled with the name of your test and <code>*.received.txt</code>. It will then try to compare this <code>*.received.txt</code> file with a <code>*.approved.txt</code> file. If the file doesn't exist, then we will see a diff tool present with our received file on the left and an empty approved file on the right.</p>
<p>At this point we have to choose between a number of options:</p>
<ul>
<li>We could take the received output and copy/save it to the approved file. Essentially approving the test.</li>
<li>We may only want parts of the received file, and copy over just the parts of what we want to the approved file.</li>
<li>Or we do nothing as we want to start over...</li>
</ul>
<p>Now we run our test again and if the test passes - then we know that we've finished as what was re-generated in the received file matches the approved file. But if we see our diff tool appear, we can analyze the differences in the diff tool and determine if we need to either adjust the approved file or adjust our code that generates the received file.</p>
<blockquote>
<p>If the above explanation still isn't clear, I'd recommend watching <a href="https://twitter.com/llewellynfalco">@LlewellynFalco's</a> video's on the topic that can be found at <a href="http://approvaltests.com">approvaltests.com</a>. He does a good job describing the concepts.</p>
</blockquote>
<h1>Next Steps!</h1>
<p>Browse the <a href="https://github.com/approvals">github org</a>,  <a href="http://approvaltests.com/videos/">watch videos</a> or <a href="http://approvaltests.com/resources/">read documentation</a> on <a href="http://approvaltests.com">approvaltests.com</a>.</p>
<p>Happy Approving!</p>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2012/01/you-are-responsible-for-making-that/">You are responsible for making that feature work. Write a test. Just do it</a></h1>
    <p class="meta">
          <time datetime="2012-01-07T05:59:00.000Z" pubdate data-updated="true">Jan 6th 2012</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>Today the <a href="http://en.wikipedia.org/wiki/Project_manager">PM</a> of a project I am working on sent an email with a small list of issues that we needed to get resolved before shipping an early build to the customer for a weekly review. In his list of issues MY NAME was tagged next to a feature that I KNOW was working. I devd it, tested, saw it work.</p>
<p>Now the project Im working on encourages unit tested code, which is a fantastic project to be on since I am a big proponent of Unit/Integration/Automated tests. Heck I wrote a tool to help run them easier (<a href="http://statlight.codeplex.com/">StatLight</a>).</p>
<h4>What I did.</h4>
<p>The problem was this. I devd a feature out in like 5 minutes, took about 2 seconds to decide if I should write a unit test to prove my feature worked and <b>this</b>
<b>
  <i>
  </i>
</b>
<b>is where I failed</b>. Manually verified my change checked in the production code without its test and I was hurriedly moved on to the next task.</p>
<p>About 20 min later I get a quick <a href="http://en.wikipedia.org/wiki/Instant_messaging">I.M.</a> from a co-worker saying he had a small merge conflict in the file I just checked-in. Quickly told him how to get around his merge issue (not realizing after he checked in) that my quick 5min dev task was accidently removed in the merge.</p>
<h4>What I SHOULD have done!</h4>
<p>What I<b> should </b>have done was write the <strong>2 lines of test code first</strong>. <i>(you can argue test after/test first, I prefer test-first)</i>. Proven my code wasnt working, by running the test, and then implement the 5 min feature making the test pass. Then when my co-worker ran into his merge issue.</p>
<p>
  <img src="http://boldandfab.files.wordpress.com/2010/11/pow.jpg" width="179" height="126" />
</p>
<p>Test would have failed telling him his merge didnt go as planned.</p>
<h4>This would have also avoided</h4>
<ul>
  <li>PM wouldnt have had to discover the issue, Screenshot and write up an email. </li>
  <li>I wouldnt have had to peruse source control history to understand why my working feature wasnt working. </li>
  <li>I wouldnt have had to willingly confess my sins in this post.</li>
</ul>
<p>If your feature doesnt have a coinciding automated test. How do you know its still working?</p>
<p>Happy Testing!</p>
</div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/12/statlight-goes-open-source/">StatLight  Goes Open Source</a></h1>
    <p class="meta">
          <time datetime="2009-12-11T03:27:00.000Z" pubdate data-updated="true">Dec 10th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>Although I made a very minor attempt at making <a href="http://statlight.net" target="_blank">StatLight</a> a for-sale product, I knew when I started that open-source was most likely going to be my long term path for <a href="http://statlight.net" target="_blank">StatLight</a>.</p>  <h5>What is it? (Silverlight Testing Automation Tool)</h5>  <p>StatLight is a tool developed for automating the setup, running, and gathering results of Silverlight unit tests. StatLight helps to speed up the feedback cycles while practicing<a href="http://en.wikipedia.org/wiki/Test-driven_development"> TDD</a>/<a href="http://en.wikipedia.org/wiki/Behavior_Driven_Development">BDD</a>/(insert your test style here) during Silverlight development.</p>  <h5>Where can I get StatLight?</h5>  <p><a href="http://StatLight.CodePlex.com">http://StatLight.CodePlex.com</a></p>  <p>&#160;</p>  <h4>Happy Coding !!!</h4>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/10/statlight-silverlight-test-automation/">StatLight (Silverlight Test Automation Tool) V0.8 Released</a></h1>
    <p class="meta">
          <time datetime="2009-10-07T12:30:00.000Z" pubdate data-updated="true">Oct 7th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p><a href="http://www.statlight.net"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_L6Vw0x_R3iw/SsyYPDL-d7I/AAAAAAAAAME/hSwnRB1lDcw/image%5B6%5D.png?imgmax=800" width="244" height="79" /></a> </p>  <h4>A new version of the StatLight tool has been released.</h4>  <h4>Download: <a href="http://www.statlight.net">http://www.statlight.net</a></h4>  <h3>Major Feature Updates:</h3>  <ul>   <li>Support for 64bit </li>    <li>Back support for previous Microsoft.Testing.Silverlight assemblies      <ul>       <li>By giving the tool a specific -v=[December2008 | March2009 | July2009], StatLight can now run the asynchronous tests supported by the Microsoft Testing library. </li>     </ul>   </li>    <li>Xml report output.      <ul>       <li>By giving the tool the -r=&lt;FilePath.xml&gt;. StatLight will write out an xml report of the test run. </li>     </ul>   </li>    <li>Update to the Silverlight 3.0 Runtime  Should be compatible with Silverlight 2.0 assemblies. </li> </ul>  <h4>Minor Updates: </h4>  <ul>   <li>Support for auto-closing modal Silverlight MessageBox dialogs. </li>    <li>Update feedback to the end user for when access to run statlight web service is not allowed (Added better feedback on how to get it up and running). </li>    <li>Added a timeout monitor to detect when the StatLight browser has not communicated with the StatLight server within a reasonable amount of time. StatLight will stop running if communication (a test message) has not arrived within 5 minutes. (Will look into making this configurable) </li> </ul>  <h5>Also to note:</h5>  <ul>   <li>Ive setup a user voice account where you can suggest or vote on future features.      <br /><a title="http://statlight.uservoice.com" href="http://statlight.uservoice.com">http://statlight.uservoice.com</a> </li> </ul>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/06/silverlight-unity-moq-backed-automocker/">Silverlight Unity &amp; Moq backed AutoMocker</a></h1>
    <p class="meta">
          <time datetime="2009-06-19T15:06:00.000Z" pubdate data-updated="true">Jun 19th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>Ive pushed the <a href="http://code.google.com/p/moq-contrib/source/detail?r=22">Silverlight Unity/Moq AutoMocker</a> into the <a href="http://code.google.com/p/moq-contrib/">moq-contrib</a> project.</p>  <p>Well the other day I need the automocker and ended up running into a bug that was in my old-old-old pre-release version of <a href="http://code.google.com/p/moq-contrib/">moq for Silverlight</a>, so I took the time to get the released version and re-compile the automocker.</p>  <p>I published it to the <a href="http://code.google.com/p/moq-contrib/">moq-contrib</a> project. Havent taken the time to create a binary release, but should be able to get latest build, execute the build.Silverlight.cmd and in the drops\Current-Silverlight should be Moq.Contrib.UnityAutoMocker.Silverlight.dll</p>  <p>Enjoy!</p>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/05/statlight-v05-released/">StatLight  V0.5 released!</a></h1>
    <p class="meta">
          <time datetime="2009-05-12T05:28:00.000Z" pubdate data-updated="true">May 11th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>A new version of <a href="http://statlight.net/" target="_blank">StatLight</a> has been released!</p>  <h4>Major Features Added:</h4>  <ul>   <li>NUnit support      <ul>       <li>Will work with any version of NUnit compiled to run under <a href="http://silverlight.com/" target="_blank">silverlight</a>.           <ul>           <li>EX: <a href="http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/" target="_blank">Jeff Wilcoxs</a> port </li>         </ul>       </li>     </ul>   </li>    <li>Further MSTest support </li>    <ul>     <li>In the previous version (0.4) you could only use <a href="http://statlight.net/" target="_blank">StatLight</a> with the <a href="http://silverlight.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=20430" target="_blank">March 2009</a> build of Microsoft.Silverlight.Testing.dll. <strong>It will now work with any version.</strong>         <br />(<strong>Update</strong>: the Silverlight Asynchronous testing style is not currently supported)</li>   </ul> </ul>  <h4>Minor Tweaks:</h4>  <ul>   <li>The debug.assertion creates a failure test event      <ul>       <li>It used to write a message to the console. It will now create a failure event, similar to a test that fails. </li>     </ul>   </li>    <li>Support for [Ignore]d tests for each supported framework (MSTest, NUnit, Xunit) </li> </ul>  <h5>Soon to come:</h5>  <ul>   <li>Xml report file export </li>    <li>Basic <a href="http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET" target="_blank">Cruise Control .net</a> support </li> </ul>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/04/introducing-statlight-silverlight_07/">Introducing StatLight (Silverlight Testing Automation Tool)</a></h1>
    <p class="meta">
          <time datetime="2009-04-07T14:10:00.000Z" pubdate data-updated="true">Apr 7th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>&#160;</p>  <p>What is it?</p>  <p>StatLight is your first class TDD/BDD/(Insert your testing style here) tool for Silverlight. Its main focus is developer productivity.</p>  <p>(The website is young, however the tool is ready to go <a title="StatLight&#39;s home website." href="http://www.StatLight.net">Download StatLight here</a>)</p>  <p>In the realm of Silverlight, the tooling support has not had the chance to catch up to what you might have come to expect from normal .net development. When developing Silverlight applications using a test driven style, with the current tooling, it can become a little more tedious than one might like. </p>  <p>A number of testing methodologies have sprung up to enable some sort of testing for Silverlight developers; however, few actually run the tests in the browser.</p>  <p>Below is a short list of features StatLight currently has.</p>  <h4>Features:</h4>  <ol>   <li>In browser runner to test how your code will actually run in the wild. </li>    <li>TeamCity Continuous Integration support </li>    <li>Smooth Console Runner      <ol>       <li>One time runner (screenshot below)<a href="http://lh5.ggpht.com/_L6Vw0x_R3iw/Sdtexix3VSI/AAAAAAAAAFw/tj48fdwRad8/s1600-h/image8.png">           <br /><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; margin-left: 0px; border-left-width: 0px; margin-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_L6Vw0x_R3iw/SdteyAUbPZI/AAAAAAAAAF0/23thaH-98lI/image_thumb6.png?imgmax=800" width="521" height="292" /></a> </li>        <li>Continuous Integration runner          <ol>           <li>This runner will startup and watches for any re-builds of your text xap file. Every time you re-build it will pick up the new test xap and immediately start running the tests. </li>            <li>This feature gives the most as far as developer productivity. </li>            <li>I will put out a video to show how best to use it soon </li>         </ol>       </li>     </ol>   </li>    <li>Tag/Filtering support (to narrow down the tests run at a given time) </li>    <li>XUnit support leveraging <a href="/2009/02/xunit-light-for-silverlight">XUnit (Light)</a> </li>    <li>MSTest support. (March 09 build) </li> </ol>  <h4>On the way:</h4>  <ol>   <li>Better Documentation and how to/help videos </li>    <li>NUnit support leveraging <a href="http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/">Jeff Wilcoxs NUnit</a> port </li>    <li>CruiseControl.net support </li>    <li>MSBuild </li> </ol>  <p><a title="StatLight&#39;s home website." href="http://www.StatLight.net">Download StatLight here</a></p>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/02/2-for-fluent-specification-extensions/">(-2) for [Fluent] Specification Extensions</a></h1>
    <p class="meta">
          <time datetime="2009-02-07T23:23:00.000Z" pubdate data-updated="true">Feb 7th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p></p>  <p>If you read my previous posts about [Fluent] Specification Extensions then you know that I'm still in an experimental phase of this idea.</p> <ol>   <li><a href="/2009/02/fluent-specification-extensions">Fluent Specification Extensions</a> </li>    <li><a href="/2009/02/fluent-specification-extensions-1-more">(+1) for [Fluent] Specification Extensions</a> </li> </ol> <p>There are two more things I've found that are going against the specification extensions idea. The first one below is related to all specification extensions, not just the fluent flavored specification extensions. </p> <h5><strong>-1.</strong> If you have a test that for some reason has an assertion in the middle of some code.</h5> <pre>[Fact]<br /><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> MockAsExistingInterfaceAfterObjectSucceedsIfNotNew()<br />{<br />	var mock = <span style="color: #0000ff">new</span> Mock&lt;IBag&gt;();<br /><br />	mock.As&lt;IFoo&gt;().SetupGet(x =&gt; x.Value).Returns(25);<br /><br />	((IFoo)mock.Object).Value.ShouldEqual(25);<br /><br />	var fm = mock.As&lt;IFoo&gt;();<br /><br />	fm.Setup(f =&gt; f.Execute());<br />}</pre><p>It's a little difficult to tell where the assertion is because you don't get the syntax highlighting help from the static class name &quot;Assert&quot;.</p><pre><font color="#25c08e">Assert</font>.Equal(25, (IFoo)mock.Object);</pre><p>However I don't think the reason above is anything to stop using the pattern for a couple of the following:</p><br /><ol><li>How often do you have assertions in the middle of your code?</li><li>If you are doing your tests right, it doesn't take long to scan the above code for the &quot;.Should...&quot; extension method.</li></ol><h5>-1. Daniel from the Moq project tweeted Scott Bellware about his spec unit projects <a href="http://code.google.com/p/specunit-net/source/browse/trunk/src/SpecUnit/SpecificationExtensions.cs?r=41" target="_blank">SpecificationExtensions.cs</a></h5><blockquote><p>@bellware shouldn't specunit ShouldNotEqual/etc. return the actual object rather than the expected? To chain other calls <a href="http://is.gd/iJuB">http://is.gd/iJuB</a></p></blockquote><blockquote><p>@bellware and ShouldBeNull/NotBeNull could also return the object: obj.ShouldNotBeNull().ShouldEqual(...), right?</p></blockquote><p>with Scott's response being...</p><blockquote><p>@kzu no because that would contribute to crowding many observations into a single method</p></blockquote><p>To that I say, True, if you are doing pure Context/Specification based unit testing. However most of us aren't actually doing it (maybe we should?) so why not allow the test to say</p><pre>someString<br />  .ShouldNotBeNull<br />  .ShouldEqual(...)?</pre><p>So for now... I'm going to continue to go with the Fluent Specification Extensions.</p>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/02/fluent-specification-extensions-1-more/">(+1) for [Fluent] Specification Extensions</a></h1>
    <p class="meta">
          <time datetime="2009-02-07T06:10:00.000Z" pubdate data-updated="true">Feb 6th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>If you read my previous post about <a href="/2009/02/fluent-specification-extensions">Fluent Specification Extensions</a> then you know that I'm still in an experimental phase of this idea.</p>  <p>I'd like to share one more positive I found by using the specification extensions in my testing framework. This benefit is there weather you use standard specification extension methods or try the fluent specification extensions. The idea is very basic, but I didn't even realize it's benefit until I ran into it directly.</p>  <p>And the great benefit is... (drum roll...errr..actually it's not mind blowing). By using extensions methods to provide assertion extensions on the objects we're testing, we've<strong> <u>abstracted the actual testing framework's assertion process.</u></strong><u> </u>(told you it wasn't mind blowing, but read along and see an example of how this abstraction could be good)</p>  <p>Now I know most times you won't ever change testing frameworks, however I just ran into this when attempting to port the Castle.DynamicProxy2 (DP2) to Silverlight. Their test project leveraged the NUnit testing framework, which hasn't officially been ported. You can find a quick <a href="http://www.jeff.wilcox.name/2009/01/nunit-and-silverlight/">port by Jeff Wilcox</a> that will run in the Microsoft Silverlight Unit Testing Framework. However when I was porting the DP2 that hadn't been done, and I didn't feel like porting NUnit at the time.</p>  <p>So, by providing this abstraction layer (through the extension methods). You could then go in and easily swap what testing framework your project is leveraging to do it's assertions.</p>  <h6>NOTE: the port from NUnit to MSFT wouldn't have been that easy as the [TestMethod] in MSFT is sealed so I couldn't create a [Test] attribute that inherited from [TestMethod] to get the SL testing framework to run the tests w/out changing the DynamicProxy test code...aside from that issue...</h6>  <p>Let's take a concrete example of this abstraction benefit.</p>  <p>Notice how the Assert.IsInstanceOfType() in both NUnit and Microsoft's testing framework have the parameters reversed.</p>  <p>NUnit:</p>  <p><a href="http://lh6.ggpht.com/_L6Vw0x_R3iw/SY0lvWzbk4I/AAAAAAAAAEw/mikfS2Ad9TQ/s1600-h/image11%5B3%5D.png"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="146" alt="image" src="http://lh3.ggpht.com/_L6Vw0x_R3iw/SY0lv1_mpxI/AAAAAAAAAE0/UMgoOPFIoiY/image11_thumb%5B2%5D.png?imgmax=800" width="584" border="0" /></a> </p>  <p>Microsoft:</p>  <p><a href="http://lh5.ggpht.com/_L6Vw0x_R3iw/SY0lwEt7LjI/AAAAAAAAAE4/cj4aScmZML4/s1600-h/image17%5B1%5D.png"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="104" alt="image" src="http://lh4.ggpht.com/_L6Vw0x_R3iw/SY0lwbo9p9I/AAAAAAAAAE8/xklqX1ujQj4/image17_thumb.png?imgmax=800" width="584" border="0" /></a> </p>  <p>If you were trying to switch from NUnit to MSFT or visa versa, a simple search and replace on [Test] for [TestMethod] would suffice for the majority of the needed port. However the Assert.IsInstanceOfType() would fail at compile time because of the parameter order. (and who know what else exactly is different)</p>  <p>If you could provide that layer of abstraction for the assertions, then to switch between NUnit and MSFT or visa versa would remain very simple, as you would only have to provide the framework specific changes only once.</p>  </div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/02/fluent-specification-extensions/">Fluent Specification Extensions</a></h1>
    <p class="meta">
          <time datetime="2009-02-05T00:14:00.000Z" pubdate data-updated="true">Feb 4th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p><strong>FYI: If you're familiar with extension methods, and how to use them in testing sceneries...the interesting part of this post is at the bottom starting at: "Ok, on to the point..."</strong></p><p>The C# extension methods give some amazing power when it comes to extending functionality of objects (we don't own) and I've spotted a pattern on several blogs and example unit testing snippets, especially in the Context Specification style testing areas that I find interesting.   <br /><br />The concept is to basically use the C# extension methods within a unit testing environment to give the system under test (SUT) more readability/understandability within the test code itself.   <br /><br />Here's an example of how you might normally write a unit test given the following SUT. </p>  <pre><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> SystemUnderTest<br />{<br />  <span style="color:#0000ff;">public</span> SystemUnderTest() { PropertyUnderTest = "<span style="color:#8b0000;">Hello World!</span>"; }<br />  <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> SomeStringProperty { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }<br />  <span style="color:#0000ff;">public</span> <span style="color:#0000ff;">bool</span> SomeBoolProperty { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }<br />}</pre><p>You might write some unit tests that might look like...</p><pre>var sut = <span style="color:#0000ff;">new</span> SystemUnderTest();<br /><br />Assert.IsTrue(sut.SomeBoolProperty);<br />Assert.AreEqual(sut.SomeStringProperty, "<span style="color:#8b0000;">Hello World!</span>");</pre><p>Now, the assertions above are small enough it's pretty easy to tell what's going on, however when you think about what your looking at, it actually present the best readability.</p><p>Let's take the string's AreEqual assertion for example... You first read the "AreEqual", so now you have to allocate some (undefined as of yet) space in your head to store some data points that need to be evaluated all at once. (maybe I'm getting lazy as I get old, but the less I have to think when reading tests the more time I can spend understanding the domain being tested...)</p><p>Again, the example is over simplified, but I think you get the point.</p><h4>What if you could make the test syntax read and flow in a very readable and understandable manner?</h4><p>That's what the specification extensions give you. Given the two tests above and an a couple helper extension methods living in the testing library I could write something like.</p><pre>var sut = <span style="color:#0000ff;">new</span> SystemUnderTest();<br />sut.SomeBoolProperty.ShouldBeTrue();<br />sut.SomeBoolProperty.ShouldEqual("<span style="color:#8b0000;">Hello World!</span>");</pre><p>It may just be me, but that just feels better, is more understandable, and the great thing is I didn't have to impact my domain objects to support this style of test...</p><p>Another great benefit is you don't have to type "Assert.xxxx(YYzzz)" each time you want to create an assertion. You can just type sut.SomeThing.{this where you get help from intellasense} giving you some great context based assertion options.</p><p>I googled for a library that had a pre-built set of extension assertions and ended up finding the <a href="http://code.google.com/p/specunit-net/source/browse/">http://code.google.com/p/specunit-net/source/browse/</a> by Scott Bellware. If you dig into the source of the project you can find a helper class called <a href="http://code.google.com/p/specunit-net/source/browse/trunk/src/SpecUnit/SpecificationExtensions.cs" target="_blank">SpecificationExtensions.cs</a> which basically gives you all the "Should..{your assertion here}" extension methods.</p><h4>Ok, on to the point real point (sorry it's taken so long).</h4><p>After downloading and playing with the extension specifications from Spec Unit, I thought what if we made that more fluent?</p><p>So I gave it a quick spike and instead of writing some tests that look like...</p><pre>sut.SomeStringProperty.ShouldNotBeNull();<br />sut.SomeStringProperty.ShouldBeOfType(<span style="color:#0000ff;">typeof</span>(<span style="color:#0000ff;">string</span>));<br />sut.SomeStringProperty.ShouldEqual("<span style="color:#8b0000;">Hello World!</span>"); </pre><p>You could have less wordy code and still retain all the meaning and readability with a set of fluent specification extensions.</p><pre>sut.SomeStringProperty<br />.ShouldNotBeNull()<br />.ShouldBeOfType(<span style="color:#0000ff;">typeof</span>(<span style="color:#0000ff;">string</span>))<br />.ShouldEqual("<span style="color:#8b0000;">Hello World!</span>");</pre><p>I haven't figured out what sorts of bad things this style of assertion could bring... but we'll experiment for a while...</p><p>Here's an example console app with the extensions included.</p><p><strong>DISCLAIMER</strong>: I haven't tested all the extensions so if you notice any issues please feel free to let me know...<br /><br /><iframe style="border-right: #dde5e9 1px solid; padding-right: 0px; border-top: #dde5e9 1px solid; padding-left: 0px; padding-bottom: 0px; margin: 3px; border-left: #dde5e9 1px solid; width: 240px; padding-top: 0px; border-bottom: #dde5e9 1px solid; height: 66px; background-color: #ffffff" marginwidth="0" marginheight="0" src="http://cid-c0f357e4555270e7.skydrive.live.com/embedrowdetail.aspx/Public/FluentSpecificationExtensions.zip" frameborder="0" scrolling="no"></iframe></p></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jazz</div>
<div class='content'>
I just added this helpful extension method to my code. Thought of sharing it.<br /><br />public static IEnumerable ShouldContain(this IEnumerable collection, Func expectedCriteria)<br />        {<br />            collection.Any(expectedCriteria).ShouldBeTrue();<br />            return collection;<br />        }</div>
</div>
<div class='comment'>
<div class='author'>tims</div>
<div class='content'>
You might find this useful:<br /><br />http://code.google.com/p/shouldit/<br /><br />ShouldIt is an open source library of fluent specification extensions that can be used with any unit testing framework.</div>
</div>
<div class='comment'>
<div class='author'>DB</div>
<div class='content'>
Whats up Stax! Man, you are always deep into stuff I can't understand!</div>
</div>
</div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/01/silverlight-automocker-with-unity/">Silverlight AutoMocker with Unity container and Moq</a></h1>
    <p class="meta">
          <time datetime="2009-01-24T07:14:00.000Z" pubdate data-updated="true">Jan 23rd 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>A couple weeks back I threw out a <a href="/2009/01/silverlight-moq-automocker-teaser" target="_blank">Teaser about a Silverlight AutoMocker</a>... Here's the follow up I promised.</p>  <p><strong><u> UPDATE: Moq 3.0 released with full Silverlight support </u></strong><a href="http://moq.me/get"><strong><u>http://moq.me/get </u></strong></a></p>  <p>I've been working on this off and on for a while now, and finally decided to sit down and finalize (at least this version) of both Moq for Silverlight and an AutoMocking container backed by the <a href="http://codeplex.com/Unity" target="_blank">Unity IoC</a> from Microsoft.</p>  <p>This isn't by any means &quot;Official&quot;, but probably not far from what will be coming out when it's done... </p>  <p>Below are the necessary steps (I can come up with) to get an official version of Moq.</p>  <ol>   <li>We need an &quot;Official&quot; build of the Castle.DynamicProxy2 dependency      <ol>       <li>Create NAnt build scripts (Jonathon Rossi said he'd try to work on it this weekend 1/23) Thank God! It tried porting the NAnt build to Silverlight and each of the 3 times I got so lost I gave up... :( </li>        <li>Fix the Castle.Core-Silverlight build (some changes have occurred to the main without being pushed to the Silverlight Version) </li>        <li>Create an official binaries of          <ol>           <li>Castle.Core </li>            <li>Castle.DynamicProxy </li>         </ol>       </li>     </ol>   </li>    <li>Port Moq to Silverlight      <ol>       <li>I supplied a patch to Daniel a while ago, but he said he wouldn't include it until #1 above. </li>     </ol>   </li> </ol>  <p>But until the official versions become available, here are what I have so far!!!</p>  <p><strong>UPDATE</strong>: oops, realized I posted the files below as .7z. You can download and install the free open source zip utility here <a href="http://www.7-zip.org/">http://www.7-zip.org/</a></p>  <p>&#160;</p>  <p>This contains the Moq, Moq-Contrib (w/unity AutoMocker) source    <br /><iframe style="border-right: #dde5e9 1px solid; padding-right: 0px; border-top: #dde5e9 1px solid; padding-left: 0px; padding-bottom: 0px; margin: 3px; border-left: #dde5e9 1px solid; width: 240px; padding-top: 0px; border-bottom: #dde5e9 1px solid; height: 66px; background-color: #ffffff" marginwidth="0" marginheight="0" src="http://cid-c0f357e4555270e7.skydrive.live.com/embedrowdetail.aspx/Public/src-MoqAndMoqContribForSilverlight.7z" frameborder="0" scrolling="no"></iframe></p>  <p>This contains all the binaries you need to run Moq...    <br /><iframe style="border-right: #dde5e9 1px solid; padding-right: 0px; border-top: #dde5e9 1px solid; padding-left: 0px; padding-bottom: 0px; margin: 3px; border-left: #dde5e9 1px solid; width: 240px; padding-top: 0px; border-bottom: #dde5e9 1px solid; height: 66px; background-color: #ffffff" marginwidth="0" marginheight="0" src="http://cid-c0f357e4555270e7.skydrive.live.com/embedrowdetail.aspx/Public/bin-MoqAndMoqContribForSilverlight.7z" frameborder="0" scrolling="no"></iframe></p>  <p>&#160;</p>  <p>Please keep in mind I'm by no means an IoC pro and the whole AutoMocker was a one afternoon attempt at throwing one together that I could use in Silverlight. It's very basic, but seems to support most of what I need for now.</p>  <p>Could an AutoMocking container backed by Moq and Unity be a project that the community needs?</p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
@Mark<br /><br />I&#39;ve been disconnected from the castle dynamic proxy for quite a while. (Last I knew Mr. Rossi was going to get it into the build process) If that&#39;s true, building from src would be your best bet. If it&#39;s not possible through the NAnt script, then, the way I originally did it, was opening up the Silverlight project in VS and building that way... (I think you have to run the NAnt build at least once for it to setup the AssemblyInfo.cs stuff before you try to vs build)<br /><br />Hope this helps. (sorry I don&#39;t have more info than this)</div>
</div>
<div class='comment'>
<div class='author'>Mark</div>
<div class='content'>
Re: the error with generic constraints - I created a test for this and it is fixed on the main build see here: http://support.castleproject.org/projects/DYNPROXY/issues/view/DYNPROXY-ISSUE-92<br /><br />I&#39;m not sure how to get this into a silverlight version - there doesn&#39;t seem to be a Silverlight build. Can you help?<br /><br />Thanks<br /><br />Mark</div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Any chance you could send an example test?</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Hi Jason, <BR/>This is really cool...thanks!<BR/><BR/>I thought you might want to know about an error I received. When mocking an interface containing generic parameter constraints, I receive the error... <BR/><BR/>System.BadImageFormatException: An attempt was made to load a program with an incorrect format.<BR/><BR/>...when running the test. <BR/><BR/>Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
@Adam - There's two things you can do.<BR/><BR/>1. Moq-contrib at google code already has an AutoMocker that uses the AutoFac IoC.<BR/><BR/>or<BR/><BR/>2. Take my source, recompile the AutoMocker in .net (make sure to get the correct full-framework dependencies)<BR/><BR/>Hope that helps...</div>
</div>
<div class='comment'>
<div class='author'>Adam</div>
<div class='content'>
I would really like an Automocker for the *WPF* side of things.</div>
</div>
</div>
</div>

            </article>
            <article>
                  <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2009/01/silverlight-moq-automocker-teaser/">Silverlight Moq AutoMocker Teaser...</a></h1>
    <p class="meta">
          <time datetime="2009-01-05T02:12:00.000Z" pubdate data-updated="true">Jan 4th 2009</time>


        
    </p>
</header>
<div class="entry-content">
<div class='post'>
<p>Although we don't have an official Moq for Silverlight yet. You can go to the email list and pull the <a href="http://groups.google.com/group/moqdisc/browse_thread/thread/957e056bd3458fb1" target="_blank">patch I submitted</a> to get an early version up and running.</p>  <p>I have, in the queue of blog posts, a Silverlight AutoMocker leveraging the new <a href="http://msdn.microsoft.com/en-us/library/dd362339.aspx" target="_blank">Microsoft Unity container for Silverlight</a>.</p>  <p>I'll wait till we get a full Silverlight version of Moq before posting.</p>  <p>&#160;</p>  <p>P.S.</p>  <p>The existing Moq automocker for the full .NET framework, over at <a href="http://code.google.com/p/moq-contrib/wiki/Automocking" target="_blank">Moq-contrib</a>, is leveraging the <a href="http://code.google.com/p/autofac/" target="_blank">Autofac</a> contianer, and when I threw my Silverlight version together Autofac hadn't been ported (yet), however just <a href="http://blogs.msdn.com/nblumhardt/archive/2009/01/04/ioc-on-silverlight.aspx" target="_blank">read a blog today</a> that said it has an early port available.</p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Not sure what you mean bout the "trick"... Mocking just works in Silverlight with Moq. There is one unit test that fails in the Silverlight version when trying to mock the System.Stream class. I didn't dig too far into the specific failure, however I'm sure there are lots of things out there that you won't be allowed to mock because of the security restrictions...</div>
</div>
<div class='comment'>
<div class='author'>Justin Chase</div>
<div class='content'>
In a nutshell, what's the trick to mocking with the given security constraints (on reflection) in Silverlight?</div>
</div>
</div>
</div>

            </article>
            <div class="pagination">
                <a href="/blog/archives">Blog Archives</a>
            </div>
        </div>



    </div>
</div>
<footer role="contentinfo"><p>
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.

</p>
<p>
  Copyright &copy; 2008-2020 - <a href="/about">Jason Jarrett</a> - <span class="credit">Powered by <a href="http://togglejs.github.io">Toggle</a></span>
</p>


<style>
  .jj-signup-form {
    text-align: right;
    position: fixed;
    bottom: 0;
    right: 0;
    width: 300px;
    display: none;
  }
</style>

<style>
    .jj-signup-form {
        border-width: thin;
        border-color: black;
        border-style: solid;
        background-color: white;
    }
</style>
<div class="jj-signup-form">
    <button class="jj-signup-form-close">Close</button>
    <div>
        <!-- Begin MailChimp Signup Form -->
        <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
        <style type="text/css">
            #mc_embed_signup {
                background: #fff;
                clear: left;
                font: 14px Helvetica, Arial, sans-serif;
            }
            /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
        </style>
        <div id="mc_embed_signup">
            <form action="//staxmanade.us8.list-manage.com/subscribe/post?u=9a6f3f89fc58e1bbbddf5c3f8&amp;id=9e5406be65" method="post"
                id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">
                    <h2>Don't miss a post...</h2>
                    <div class="mc-field-group">
                        <label for="mce-FNAME">First Name </label>
                        <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
                    </div>
                    <div class="mc-field-group">
                        <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
                        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                    </div>
                    <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>
                    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9a6f3f89fc58e1bbbddf5c3f8_9e5406be65" tabindex="-1" value=""></div>
                    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
        </div>
        <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script>
        <script type='text/javascript'>
            (function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[1]='FNAME';ftypes[1]='text';fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);
        </script>
        <!--End mc_embed_signup-->
    </div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.1/js.cookie.min.js"></script>
<script>
  (function(){
    try {
      if (Cookies.get('IKnowItIsACrappyPopupButMeh') !== "clicked") {
        document.querySelector('.jj-signup-form-close').addEventListener('click', function(){
            document.querySelector('.jj-signup-form').style.display = "none";
            Cookies.set("IKnowItIsACrappyPopupButMeh", "clicked", { expires: 180 });
        });

        setTimeout(function(){
          if(window.jjdisableSignupPopup) {
            return;
          }
          document.querySelector('.jj-signup-form').style.display = "initial";
        }, 1000);
      }

    } catch(e) {
        console.log(e);
    }
  })();

</script>
</footer>
  



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



</body>
</html>
