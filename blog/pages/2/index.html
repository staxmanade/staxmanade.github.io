<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Developing on Staxmanade - Developing on Staxmanade</title>
  <meta name="author" content="Jason Jarrett">


   <meta name="description" content="Jason Jarrett&#x27;s Blog and Website.">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://staxmanade.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/DevelopingOnStaxmande" rel="alternate" title="Developing on Staxmanade" type="application/atom+xml">
    <script src="/js/modernizr-2.0.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./js/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6814534742514314",
          enable_page_level_ads: true
     });
</script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1017448-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body   >
<header role="banner"><hgroup>
  <h1><a href="/">Developing on Staxmanade</a></h1>

   <a class="subscribe-button" href="/subscribe">Subscribe</a>
</hgroup>

</header>
<nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/DevelopingOnStaxmande" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<div>
  <form action="//www.google.com" id="cse-search-box">
    <div>
      <input type="hidden" name="cx" value="partner-pub-6814534742514314:2581894146" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" name="q" size="25" />
      <input type="submit" name="sa" value="Search" />
    </div>
  </form>

  <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
</div>
</nav>
<div id="main">
    <div id="content">
        
<div class="blog-index">
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/09/how-to-update-a-single-running-docker-compose-container/">How to Update a Single Running docker-compose Container</a></h1>
    <p class="meta">
          <time datetime="2016-09-09T04:45:17.565Z" pubdate data-updated="true">Sep 8th 2016</time>


        <a href="/2016/09/how-to-update-a-single-running-docker-compose-container/#disqus_thread" data-disqus-identifier="/2016/09/how-to-update-a-single-running-docker-compose-container/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>As a newbie to the tooling, <a href="https://docs.docker.com/compose/">docker-compose</a> it's great for getting started. To bring up all the service containers with a simple <code>docker-compose up</code> starts everything. However, what if you want to replace an existing container without tearing down the entire suite of containers?</p>
<p>For example: I have a <code>docker-compose</code> project that has the following containers.</p>
<ol>
<li>Node JS App</li>
<li>CouchDB</li>
<li>Redis Cache</li>
</ol>
<p>I had a small configuration change within the CouchDB container that I wanted to update and re-start to get going but wasn't sure how to do that.</p>
<h1>Here's how I did it with little down time.</h1>
<p>I'm hoping there are better ways to go about this (I'm still learning), but the following steps are what I used to replace a running docker container with the latest build.</p>
<ol>
<li>Make the necessary change to the container (in my case update the couchdb config).</li>
<li>Run <code>docker-compose build couchdb</code> (<code>docker-compose build &lt;service_name&gt;</code> where <code>service_name</code> is the name of the docker container defined in your <code>docker-compose.yml</code> file.)</li>
</ol>
<p>Once the change has been made and container re-built, we need to get that new container running (without affecting the other containers that were started by docker-compose).</p>
<ol>
<li><code>docker-compose stop &lt;service_name&gt;</code> &lt;-- If you want to live on the edge and have the shut-down go faster, try <code>docker-compose kill &lt;service_name&gt;</code></li>
<li><code>docker-compose up -d --no-deps &lt;service_name&gt;</code> &lt;-- this brings up the service using the newly built container.</li>
</ol>
<p>The <code>-d</code> is Detached mode: Run containers in the background, print new container names.</p>
<p>The <code>--no-deps</code> will not start linked services.</p>
<p>That's it... at least for me, it's worked to update my running containers with the latest version without tearing down the entire docker-compose set of services.</p>
<blockquote>
<p>Again, if you know of a faster/better way to go about this, I'd love to hear it. Or if you know of any down-sides to this approach, I'd love to hear about it before I have to learn the hard way on a production environment.</p>
</blockquote>
<h2>UPDATE:</h2>
<p>Thanks to Vladimir in the comments below - you can skip several steps above and do it with a single command</p>
<pre><code><span class="hljs-comment">docker</span><span class="hljs-literal">-</span><span class="hljs-comment">compose</span> <span class="hljs-comment">up</span> <span class="hljs-literal">-</span><span class="hljs-comment">d</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">no</span><span class="hljs-literal">-</span><span class="hljs-comment">deps</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">build</span> &lt;<span class="hljs-comment">service_name</span>&gt;
</code></pre>
<p>I tested this and was able to avoid the <code>build</code>, <code>kill</code>, and <code>up</code> commands with this one-liner.</p>
<p>Happy Container Updating!</p>
</div>

      <a href="/2016/09/how-to-update-a-single-running-docker-compose-container/#disqus_thread" data-disqus-identifier="/2016/09/how-to-update-a-single-running-docker-compose-container/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/07/run-multiple-docker-environments--qa--beta--prod--from-the-same-docker-compose-file-/">Run Multiple Docker Environments (qa, stage, prod) from the Same docker-compose File.</a></h1>
    <p class="meta">
          <time datetime="2016-07-27T05:24:03.338Z" pubdate data-updated="true">Jul 26th 2016</time>


        <a href="/2016/07/run-multiple-docker-environments--qa--beta--prod--from-the-same-docker-compose-file-/#disqus_thread" data-disqus-identifier="/2016/07/run-multiple-docker-environments--qa--beta--prod--from-the-same-docker-compose-file-/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>So, I'm playing around with some personal projects and looking to deploy some simple things with <a href="https://www.docker.com/">Docker</a> to DigitalOcean. This personal project is a small site, and I'd like to set myself up with a repeatable deployment solution (that may be automated as much as possible) so I don't trip over myself with server hosting as I build out the web application.</p>
<p>I'm not really strong with server infrastructure and some of this is &quot;figure it out as I go&quot;, while more of it is asking for help from a good friend <a href="https://twitter.com/icecreammatt">@icecreammatt</a> who has been a HUGE help as I stumble through this.</p>
<p>But at the end of this tutorial our goal is to satisfy the following requirements.</p>
<h1>High level requirements:</h1>
<p>Below are some core requirements this walk-through should help address. There is likely room for improvement, and I'd love to hear any feedback you have along the way to simplify things or make them more secure. But hopefully you find this useful.</p>
<p>I want there to be some semblance of a release process with various deployment environments. Push changes to <code>qa</code> regularly, push semi-frequently to <code>stage</code> and when things are good, ship a version to production.</p>
<ol>
<li>Have access to environments through various domain names. EX: if prod was <code>my-docker-test-site.com</code> then I would also have <code>qa.my-docker-test-site.com</code> and <code>stage.my-docker-test-site.com</code></li>
<li>Ability to run multiple &quot;environments&quot;: <code>qa</code>, <code>stage</code>, <code>prod</code> in the same system. (prob not that many environments - but you get the picture)</li>
<li>Deploy to various environments without affecting other environments. (Ship updates to qa)</li>
<li>It'd be great if I can figure out a mostly zero-downtime deployment. (Not looking for perfect, but the less downtime the better)</li>
<li>Keep costs low. For a small site - running all environments on say a small DigitalOcean droplet. (Is this even possible? We'll see...)</li>
<li>Build various environments, test them out locally and then deploy them to the cloud (<img class="emoji" title="cloud" alt="cloud" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2601.png" height="20" width="20" align="absmiddle">)</li>
</ol>
<p>While I'd like the ability to run as many environments as I listed above, I will likely use a <code>qa</code> and <code>prod</code> for my small site, but I think the pattern is such that we could easily setup whatever environments we need.</p>
<h1>Structure of post:</h1>
<p>What we want to do is essentially walk through how I'm thinking about accomplishing the above high level requirements using a simple <a href="https://nodejs.org/en/">node js</a> hello world application. This app is a basic node app that renders some environment information just to prove that we can correctly configure and deploy various docker containers for environments such as <code>qa</code>, <code>stage</code> or <code>prod</code>.</p>
<p>In the end, we should end up with something that I like to imagine looks a bit like this diagram:</p>
<p><img alt="diagram of nginx-proxy in front of web app containers on a DigitalOcean droplet" src="/images/posts/VisualOfContainers.svg" style="border:0; box-shadow: none" /></p>
<p>I'm going to use <a href="https://m.do.co/c/451940554550">DigitalOcean</a> as the cloud provider in this case, but I think this pattern could be to other docker hosting environments.</p>
<h1>Example Web App Structure</h1>
<p>Below is a basic view of the file structure of our site. If you're following along, go ahead and create this structure with empty files, we can fill them in as we go...</p>
<pre><code>.
|<span class="hljs-string">____app
</span>|<span class="hljs-string"> </span>|____Dockerfile
|<span class="hljs-string"> </span>|<span class="hljs-string">____server.js
</span>|<span class="hljs-string">____docker-compose.yml
</span></code></pre>
<p>Let's start with the <code>./app/*</code> files:</p>
<h2>Simple NodeJS Hello World app</h2>
<p>This is a simple nodejs server that we can use to show that deployment environment variables are passed through and we are running the correct <code>environment</code>. As well as showing a functioning web server.</p>
<p>File: <code>./app/server.js</code></p>
<pre><code><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>{
    res.writeHead(<span class="hljs-number">200</span>, {<span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span>});
    res.end(<span class="hljs-string">`
Hello World!

VIRTUAL_HOST: <span class="hljs-subst">${process.env.VIRTUAL_HOST}</span>
NODE_ENV: <span class="hljs-subst">${process.env.NODE_ENV}</span>
PORT: <span class="hljs-subst">${process.env.PORT}</span>

`</span>.split(<span class="hljs-string">'/n'</span>).join(<span class="hljs-string">'&lt;br&gt;'</span>));
});

server.listen(<span class="hljs-number">80</span>);
</code></pre>
<p>The goal of this file is to run a nodejs web server that will return a text document with <code>Hello World!</code> along with the environment variables that the current container are running under such as <code>qa</code>.</p>
<p>This could easily be replaced with a python, php or ruby, or a whatever web server. Just keep in mind the rest of the article may assume it's a node environment (like the <code>Dockerfile</code> up next). So adjust accordingly.</p>
<h2>The Dockerfile</h2>
<p>Below is pretty basic and says, load up and run our nodejs <code>server.js</code> web app on port <code>80</code>.</p>
<p>File: <code>./app/Dockerfile</code></p>
<pre><code><span class="hljs-comment"># Start from a standard nodejs image</span>
<span class="hljs-built_in">FROM</span> node

<span class="hljs-comment"># Copy in the node app to the container</span>
<span class="hljs-built_in">COPY</span> <span class="bash">./server.js /app/server.js
</span><span class="hljs-built_in">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-comment"># Allow http connections to the server</span>
<span class="hljs-built_in">EXPOSE</span> <span class="hljs-number">80</span>

<span class="hljs-comment"># Start the node server</span>
<span class="hljs-built_in">CMD</span> <span class="bash">[<span class="hljs-string">"node"</span>, <span class="hljs-string">"server.js"</span>]
</span></code></pre>
<h1>How to get the qa, prod domain mappings</h1>
<p>So now that we have a basic application defined, we <strong>can't</strong> host multiple versions of the app all using port <code>80</code> without issue. One approach we can take would be to place an Nginx proxy in front of our containers to allow translation of incoming domain name requests to our various web app containers which we'll use docker to host on different ports.</p>
<p>The power here is we don't have to change the port within the docker container (as shown in the <code>Dockerfile</code> above) but we can use the port mapping feature when starting up the docker container to specify different ports for different environments.</p>
<p>For example I'd like <code>my-docker-test-site.com</code> to map to the production container, <code>qa.my-docker-test-site.com</code> the <code>qa</code> container of my site, etc... I'd rather not access <code>my-docker-test-site.com:7893</code> or some port for <code>qa</code>, <code>stage</code>, etc...</p>
<p>To accomplish this we are going to use <a href="https://github.com/jwilder/nginx-proxy">jwilder/nginx-proxy</a>. Check out his <a href="http://jasonwilder.com/blog/2014/03/25/automated-nginx-reverse-proxy-for-docker/">introductory blog post</a> on the project. We'll be using the <a href="https://hub.docker.com/r/jwilder/nginx-proxy/">pre-build container</a> directly.</p>
<p>To spin this up on our local system let's issue the following command:</p>
<pre><code>docker run -d -<span class="hljs-tag">p</span> <span class="hljs-number">80</span>:<span class="hljs-number">80</span> --name nginx-proxy -v /var/run/docker<span class="hljs-class">.sock</span>:/tmp/docker<span class="hljs-class">.sock</span>:ro jwilder/nginx-proxy
</code></pre>
<p>This project is great, now, as we add new or remove containers they will automatically be added/removed to the proxy and we should be able to access their web servers through a <code>VIRTUAL_HOST</code>. (more on how specifically below)</p>
<h1>Networking</h1>
<p>Before we get too far into the container environment of our app, we need to consider how the containers will be talking to each other.</p>
<p>We can do this using the <code>docker network</code> commands. So we're going to create a new network and then allow the nginx-proxy to communicate via this network.</p>
<p>First we'll create a new network and give it a name of <code>service-tier</code>:</p>
<pre><code>docker network <span class="hljs-operator"><span class="hljs-keyword">create</span> service-<span class="hljs-keyword">tier</span>
</span></code></pre>
<p>Next we'll configure our nginx-proxy container to have access to this network:</p>
<pre><code>docker network <span class="hljs-keyword">connect</span> service-tier nginx-proxy
</code></pre>
<p>Now when we spin up new containers we need to be sure they are also connected to this network or the proxy will not be able to identify them as they come online. This is done in a <a href="https://docs.docker.com/compose/">docker-compose</a> file as seen below.</p>
<h1>Put the two together</h1>
<p>Now that we've defined our application with the <code>server.js</code> and <code>Dockerfile</code> and we have a <code>nginx-proxy</code> ready to proxy to our environment-specific docker http servers, we're going to use <code>docker-compose</code> to help build our container and glue the parts together as well as pass environment variables through to create multiple deployment environments.</p>
<p>Save this file as <code>docker-compose.yml</code></p>
<pre><code><span class="hljs-attribute">version</span>: <span class="hljs-string">'2'</span>

<span class="haml">services:
  web:
    build: ./app/
    environment:
      -<span class="ruby"> <span class="hljs-constant">NODE_ENV</span>=<span class="hljs-variable">${</span><span class="hljs-constant">NODE_ENV</span>}
</span>      -<span class="ruby"> <span class="hljs-constant">PORT</span>=<span class="hljs-variable">${</span><span class="hljs-constant">PORT</span>}
</span>      -<span class="ruby"> <span class="hljs-constant">VIRTUAL_HOST</span>=<span class="hljs-variable">${</span><span class="hljs-constant">VIRTUAL_HOST</span>}
</span>      -<span class="ruby"> <span class="hljs-constant">VIRTUAL_PORT</span>=<span class="hljs-variable">${</span><span class="hljs-constant">PORT</span>}
</span>    ports:
      -<span class="ruby"> <span class="hljs-string">"127.0.0.1:${PORT}:80"</span>
</span>
networks:
  default:
    external:
      name: service-tier
</span></code></pre>
<p>This file is all about:</p>
<ol>
<li>The <code>build: ./app/</code> is the directory where our <code>Dockerfile</code> build is.</li>
<li>The list of <code>environment</code> variables are important. The <code>VIRTUAL_HOST</code> and <code>VIRTUAL_PORT</code> are used by the nginx-proxy to know what port to proxy requests for and at what host/domain name. (We'll show an example later) You can see an earlier exploratory post I wrote <a href="https://staxmanade.com/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">explaining more about environment vars</a>.</li>
<li>The <code>ports</code> example is also important. We don't want to access the container by going <code>my-docker-test-site.com:8001</code> or whatever port we're actually running the container on because we want to use the <code>VIRTUAL_HOST</code> feature of nginx-proxy to allow us to say <code>qa.my-docker-test-site.com</code>. This configuration sets it up to only listen on the loopback network so the nginx-proxy can proxy to these containers but they aren't accessible from the inter-webs.</li>
<li>Lastly the <code>networks:</code> we define a <code>default</code> network for the web app to use the <code>service-tier</code> that we setup earlier. This allows the nginx-proxy and our running instances of the web container to correctly talk to each other. (I actually have no idea what I'm saying  here - but it is simple enough to setup and I think it's all good - so I'm going with it for now...)</li>
</ol>
<h1>Now what?</h1>
<p>So with all of these pieces in place, all we need to do now is run some docker-compose commands to spin up our necessary environments.</p>
<p>Below is an example script that can be used to spin up <code>qa</code>, and <code>prod</code> environments.</p>
<pre><code>BASE_SITE=my-docker-test-site.com

<span class="hljs-comment"># qa</span>
<span class="hljs-built_in">export</span> NODE_ENV=qa
<span class="hljs-built_in">export</span> PORT=<span class="hljs-number">8001</span>
<span class="hljs-built_in">export</span> VIRTUAL_HOST=<span class="hljs-variable">$NODE_ENV</span>.<span class="hljs-variable">$BASE_SITE</span>
docker-compose -p <span class="hljs-variable">${VIRTUAL_HOST}</span> up <span class="hljs-operator">-d</span>


<span class="hljs-comment"># prod</span>
<span class="hljs-built_in">export</span> NODE_ENV=production
<span class="hljs-built_in">export</span> PORT=<span class="hljs-number">8003</span>
<span class="hljs-built_in">export</span> VIRTUAL_HOST=<span class="hljs-variable">$BASE_SITE</span>
docker-compose -p <span class="hljs-variable">${VIRTUAL_HOST}</span> up <span class="hljs-operator">-d</span>
</code></pre>
<p>This script is <a href="https://staxmanade.com/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">setting some environment variables</a> that are then used by the <code>docker-compose</code> command where and we're also setting a unique <strong>project name</strong> with <code>-p ${VIRTUAL_HOST}</code>.</p>
<h1>Project Name</h1>
<p>What we said just before this headline is a key part to this. What enables us to run essentially the same project (docker-compose/Dockerfile) but with different environment variables that define things like <code>qa</code> vs <code>prod</code> is when we run <code>docker-compose</code> we're also passing in a <code>-p</code> or <code>--project-name</code> parameter. This allows us to create multiple container instances with different environment variables that all run on <strong>different ports</strong> and in theory isolate themselves from the other environments.</p>
<p>The thinking here is you could have a single <code>docker-compose.yml</code> file that has multiple server definitions like say a <code>nodejs web</code>, <code>couchdb</code>, and <code>redis</code> database all running isolated within their environment.  You can then use the environment variables to drive various items such as feature-toggling newly developed features in a <code>qa</code> environment, but are not necessarily ready to run in a production environment.</p>
<h1>Running/testing this out locally</h1>
<p>You probably want to play with this idea and test it out locally before trying to push it to a remote system.</p>
<p>One easy way to do this is to modify your <code>/etc/hosts</code> file (on *nix) or follow <a href="http://www.howtogeek.com/howto/27350/beginner-geek-how-to-edit-your-hosts-file/">this on windows</a> to map the specific domain names you have setup for your environments to the actual service running docker. This will allow the <code>nginx-proxy</code> to do it's magic.</p>
<p>I'm currently still using <code>docker-machine</code> to run my docker environment in a VirtualBox VM so my <code>/etc/hosts</code> file looks like this.</p>
<pre><code><span class="hljs-preprocessor">##</span>
<span class="hljs-preprocessor"># Host Database</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># localhost is used to configure the loopback interface</span>
<span class="hljs-preprocessor"># when the system is booting.  Do not change this entry.</span>
<span class="hljs-preprocessor">##</span>
<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>   localhost
<span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.255</span> broadcasthost
::<span class="hljs-number">1</span>             localhost

<span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.100</span> qa.my-docker-test-site.com
<span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.100</span> stage.my-docker-test-site.com
<span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.100</span> my-docker-test-site.com

</code></pre>
<p>If you have the docker containers running that we've worked through so far (for all environments) we should be able to visit <code>qa.my-docker-test-site.com</code> in the browser and hopefully get this:</p>
<pre><code>Hello World!

<span class="hljs-label">VIRTUAL_HOST:</span> qa.my-docker-test-site.com
<span class="hljs-label">NODE_ENV:</span> qa
<span class="hljs-label">PORT:</span> <span class="hljs-number">8001</span>
</code></pre>
<p>Also try out the production environment at <code>my-docker-test-site.com</code> to verify it is working as expected.</p>
<p><strong>THIS IS AWESOME :)</strong> I was actually quite happy to traveled this far in this exploration. But now let's try to take it up a notch and deploy what we just built locally to the DigitalOcean in the cloud (<img class="emoji" title="cloud" alt="cloud" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2601.png" height="20" width="20" align="absmiddle">).</p>
<h1>Deploy to the Cloud!</h1>
<p>Now how do we get this locally running multi-environment system up to a server in the cloud?</p>
<p>Just tonight while researching options I found this simple set of steps to get it going on DigitalOcean. I say simple because you should the original steps I was going to try and use to deploy this... sheesh.</p>
<p>These are the steps we're going to walk through.</p>
<ol>
<li>Get an Account @ <a href="https://m.do.co/c/451940554550">DigitalOcean</a></li>
<li>Create a Docker Droplet (this was way-cool)</li>
<li>Build and Deploy our nginx-proxy.</li>
<li>Build and Deploy our App</li>
<li>Configure our DNS (domain name)</li>
<li>Profit!</li>
</ol>
<p>Tonight I discovered this <a href="https://docs.docker.com/machine/examples/ocean/">blog post</a> on docker that describes using <a href="https://docs.docker.com/machine/">docker-machine</a> with the <a href="https://docs.docker.com/machine/drivers/digital-ocean/">digitalocean driver</a> to do basically everything we did above - but IN THE CLOUD <img class="emoji" title="cloud" alt="cloud" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2601.png" height="20" width="20" align="absmiddle"> - kind of blew me away actually.</p>
<h2>Get an Account</h2>
<p>First make sure you've signed up with a <a href="https://m.do.co/c/451940554550">DigitalOcean</a> and are signed in.</p>
<h2>Create a Docker Droplet (this was way-cool)</h2>
<p>Next we're going to use a cool feature of <a href="https://docs.docker.com/machine/">docker-machine</a> where we can leverage the <a href="https://docs.docker.com/machine/drivers/digital-ocean/">DigitalOcean driver</a> to help us create and manage our docker images.</p>
<p>Complete <code>Step 1</code> and <code>Step 2</code> in the following post <a href="https://docs.docker.com/machine/examples/ocean/">DigitalOcean example</a> to acquire a DigitalOcean personal access token.</p>
<p>Now that you have your DigitalOcean api token, you do right? Either pass it direclty into the below command (in place of <code>$DOTOKEN</code> or set a local var as demonstrated.</p>
<pre><code>DOTOKEN=XXXX &lt;-- your token there...
docker-machine create --driver digitalocean --digitalocean-access-token <span class="hljs-variable">$DOTOKEN</span> docker-multi-environment
</code></pre>
<blockquote>
<p>NOTE: There was an issue where (this used to work but stopped with the the docker-machine DigitalOcean default image <a href="https://github.com/docker/machine/issues/3394">reported here</a>). To work around this try using a different image name</p>
</blockquote>
<p>EX:</p>
<pre><code>DIGITALOCEAN_IMAGE=<span class="hljs-string">"ubuntu-16-04-x64"</span>
docker-machine create --driver digitalocean --digitalocean-access-token <span class="hljs-variable">$DOTOKEN</span> docker-multi-environment
</code></pre>
<p>If you refreshed your DigitalOcean's <a href="https://cloud.digitalocean.com/droplets">droplets page</a> you should see a new droplet called <code>docker-multi-environment</code>.</p>
<p>We can now configure our local terminal to allow all docker commands to run against this remotely running docker environment on our newly created droplet.</p>
<pre><code><span class="hljs-keyword">eval</span> <span class="hljs-variable">$(</span>docker-machine <span class="hljs-keyword">env</span> docker-multi-environment)
</code></pre>
<p>If you ran <code>docker ps</code> it should be empty, but this is literally listing the containers that are running up at DigitalOceain in our droplet. How awesome is that?</p>
<h2>Build and Deploy our nginx-proxy.</h2>
<p>Now that we can just speak <code>docker</code> in the cloud, run the following commands - these are all assuming we're executing them against the DigitalOcean droplet in the <img class="emoji" title="cloud" alt="cloud" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2601.png" height="20" width="20" align="absmiddle">!!</p>
<ol>
<li>
<p>Spin up our remote <code>nginx-proxy</code> on the remote droplet</p>
<pre><code>docker run -d -<span class="hljs-tag">p</span> <span class="hljs-number">80</span>:<span class="hljs-number">80</span> --name nginx-proxy -v /var/run/docker<span class="hljs-class">.sock</span>:/tmp/docker<span class="hljs-class">.sock</span>:ro jwilder/nginx-proxy
</code></pre>
</li>
<li>
<p>Create our network</p>
<pre><code>docker network <span class="hljs-operator"><span class="hljs-keyword">create</span> service-<span class="hljs-keyword">tier</span>
</span></code></pre>
</li>
<li>
<p>Tell <code>nginx-proxy</code> about this network</p>
<pre><code>docker network <span class="hljs-keyword">connect</span> service-tier nginx-proxy
</code></pre>
</li>
</ol>
<h2>Build and Deploy our App</h2>
<p>I know this post has gotten a bit long, but if you've made it this far we're almost there...</p>
<p>If you were to run the following script in our local project's folder where we have the <code>docker-compose.yml</code> file:</p>
<blockquote>
<p>Be sure to update <code>BASE_SITE=my-docker-test-site.com</code> with your domain name or sub-domain like <code>BASE_SITE=multi-env.my-docker-test-site.com</code></p>
</blockquote>
<pre><code>BASE_SITE=my-docker-test-site.com

<span class="hljs-comment"># qa</span>
<span class="hljs-built_in">export</span> NODE_ENV=qa
<span class="hljs-built_in">export</span> PORT=<span class="hljs-number">8001</span>
<span class="hljs-built_in">export</span> VIRTUAL_HOST=<span class="hljs-variable">$NODE_ENV</span>.<span class="hljs-variable">$BASE_SITE</span>
docker-compose -p <span class="hljs-variable">${VIRTUAL_HOST}</span> up <span class="hljs-operator">-d</span>


<span class="hljs-comment"># prod</span>
<span class="hljs-built_in">export</span> NODE_ENV=production
<span class="hljs-built_in">export</span> PORT=<span class="hljs-number">8003</span>
<span class="hljs-built_in">export</span> VIRTUAL_HOST=<span class="hljs-variable">$BASE_SITE</span>
docker-compose -p <span class="hljs-variable">${VIRTUAL_HOST}</span> up <span class="hljs-operator">-d</span>
</code></pre>
<p>You should now be able to run <code>docker ps</code> or <code>docker-compose ps</code> and see 3 containers running. The <code>nginx-proxy</code>, your <code>qa</code> site and also the <code>prod</code> site.</p>
<p>All that's left is to make sure DNS is configured and pointing to our <code>nginx-proxy</code> front-end...</p>
<p>While playing with this - I kept tearing down droplets and re-building them as I worked through this tutorial and I kept forgetting to adjust my DNS settings. However right in the middle of writing this tutorial DigitalOcean came out with <a href="https://www.digitalocean.com/community/tutorials/how-to-use-floating-ips-on-digitalocean">Floating Ip's</a> which wasn't perfect, but definitely made this easier to work with. I didn't have to always update the IP address of my droplet, but instead just update the floating ip to point to the newly created droplet.</p>
<h2>Configure our DNS (domain name)</h2>
<p>I'm assuming you've already purchased a domain name that you can setup and configure on DigitalOcean. So I don't want to go too far into this process.</p>
<p>I also think DNS is out of scope for this post (as there are many others who can do a better job) but I used some great resources such as these while configuring my DigitalOcean setup.</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-host-name-with-digitalocean">How To Set Up a Host Name with DigitalOcean</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-and-test-dns-subdomains-with-digitalocean-s-dns-panel">How To Set Up and Test DNS Subdomains with DigitalOcean's DNS Panel</a></li>
</ul>
<h1>Environment All Things</h1>
<p>If you've made it this far, you hopefully have a DigitalOcean droplet that is now serving <code>qa</code> and <code>prod</code> http requests.</p>
<p>NICE!!!</p>
<p>Now the most important thing - how to seamlessly update an environment with a new build...</p>
<h1>Let's make an update to QA.</h1>
<p>Now that we've deployed our site to QA and to walk through this a little further, let's make a modification to our <code>qa</code> site and see if we can get it deployed without causing any downtime especially to the <code>prod</code> site, but maybe we can also get an in-place deployment done and have little-to-no down time in <code>qa</code> as well.</p>
<p>I wrote that paragraph above the other night near bedtime and as I'm learning some of this on the fly had no idea if this would be easy enough to accomplish, but to my surprise deploying an update to <code>qa</code> was a piece of cake.</p>
<p>For this test I made a simple change to my node web server code so I could easily see that the change was deployed (or not).</p>
<p>I turned <code>Hello World!</code> into <code>Hello World! V2</code> below.</p>
<p>File: <code>./app/server.js</code></p>
<pre><code><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>)</span>{
    res.writeHead(<span class="hljs-number">200</span>, {<span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span>});
    res.end(<span class="hljs-string">`
Hello World!

VIRTUAL_HOST: <span class="hljs-subst">${process.env.VIRTUAL_HOST}</span>
NODE_ENV: <span class="hljs-subst">${process.env.NODE_ENV}</span>
PORT: <span class="hljs-subst">${process.env.PORT}</span>

`</span>.split(<span class="hljs-string">'/n'</span>).join(<span class="hljs-string">'&lt;br&gt;'</span>));
});

server.listen(<span class="hljs-number">80</span>);
</code></pre>
<p>I then used <code>docker-compose</code> to bring up another &quot;environment&quot; but using the same <code>qa</code> <code>VIRTUAL_HOST</code> as before.</p>
<pre><code>BASE_SITE=my-docker-test-site.com

export NODE_ENV=qa
export PORT=<span class="hljs-number">8004</span>
export VIRTUAL_HOST=<span class="hljs-variable">$NODE</span>_ENV.<span class="hljs-variable">$BASE</span>_SITE
docker-compose -p ${VIRTUAL_HOST}x2 up -d
</code></pre>
<blockquote>
<p>NOTICE: how the <code>-p</code> parameter we added <code>x2</code> (just to give it a different project name (for being a different version)).</p>
</blockquote>
<p>This will bring up another docker container with our updated web application and to my surprise the nginx-proxy automatically chose this new container to send requests to.</p>
<p>So if you <code>docker ps</code> you should see 4 containers running. 1 nginx-proxy, 1 prod container, 2 qa containers (with different names).</p>
<p>You can think about leaving both containers running for the moment while  you test out the new release.</p>
<p>One neat thing you can think about with this is if there was something seriously wrong with the new qa release you could just stop the new container and (<code>docker stop &lt;new_container_id&gt;</code>) and the proxy will start redirecting back to the old qa container. (That only works of course if your deployment was immutable - meaning you didn't have the new container run some one way database migration script... but that's not something I want to think about or cover in this post).</p>
<p>Once you're comfortable running the new version you can now bring down and cleanup the older version.</p>
<pre><code>docker <span class="hljs-keyword">ps</span> # <span class="hljs-keyword">to</span> <span class="hljs-keyword">list</span> the containers running
docker <span class="hljs-keyword">stop</span> &lt;old_qa_container_id&gt;

docker images # <span class="hljs-keyword">to</span> <span class="hljs-keyword">list</span> the images we have <span class="hljs-keyword">on</span> our instance
docker rmi &lt;old_qa_image_id&gt;
</code></pre>
<h1>Now let completely remove our test...</h1>
<p>You probably don't want to run the sample node script from above forever as you'll be charged some money from DigitalOcean for this and I'd feel bad if you received a bill for this little test beyond a few pennies as you test it out...</p>
<p>The following command will completely remove the droplet from DigitalOcean.</p>
<pre><code><span class="hljs-label">docker</span>-machine rm docker-<span class="hljs-keyword">multi-environment
</span></code></pre>
<h1>Wrap Up and What's Next?</h1>
<p>I feel like I've done enough learning and sharing in this post. But there is still more to do...</p>
<p>If you want to check out the snippets above combined into a sample github repository I've put it <a href="https://github.com/staxmanade/sample-docker-compose-multiple-environment.git">up here</a>.</p>
<h1>Future thinking...</h1>
<p>I don't know if I'll blog about these, but I definitely want to figure them out. If you find a way to extend my sample above to include the following I'd love to hear about it...</p>
<ul>
<li>SSL (consider cloudflare or letsencrypt?)</li>
<li>Easy way to secure the qa/stage environments?</li>
</ul>
<p>Happy Docker Enviornment Building!</p>
</div>

      <a href="/2016/07/run-multiple-docker-environments--qa--beta--prod--from-the-same-docker-compose-file-/#disqus_thread" data-disqus-identifier="/2016/07/run-multiple-docker-environments--qa--beta--prod--from-the-same-docker-compose-file-/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/07/easily-simulate-slow-async-calls-using-javascript-async-await/">Easily simulate slow async calls using JavaScript async/await</a></h1>
    <p class="meta">
          <time datetime="2016-07-08T12:34:43.041Z" pubdate data-updated="true">Jul 8th 2016</time>


        <a href="/2016/07/easily-simulate-slow-async-calls-using-javascript-async-await/#disqus_thread" data-disqus-identifier="/2016/07/easily-simulate-slow-async-calls-using-javascript-async-await/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>Recently I wanted to manually and visually test some U.I. that I couldn't easily see because an async operations was happening two fast. (first world problems)</p>
<p>I've really been enjoying the new <code>async/await</code> syntax that can be leveraged in recent JavaScript transpires such as Babel and TypeScript but when it happens so fast on a local development environment, some U.I. interactions could get tough to test out. <strong>So how can we slow this down or more appropriately add some stall time?</strong></p>
<p>As an example, let's say you have the following <code>async</code> javascript method</p>
<pre><code>
<span class="hljs-keyword">var</span> doSomething = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> someRemoteOperation();
  <span class="hljs-keyword">await</span> doSomethingElse(data);
}

</code></pre>
<p>If the first or second asynchronous methods in the example above were running too fast (as were in my case), I was pleased to see how easy it was to inject a bit of code to manually stall the operation.</p>
<p>The snippet below is short and sweet... this just delays continuous execution of an async operation for 3 seconds.</p>
<pre><code>  await new Promise<span class="hljs-list">(<span class="hljs-keyword">resolve</span> =&gt; setTimeout<span class="hljs-list">(<span class="hljs-keyword">resolve</span>, <span class="hljs-number">3000</span>)</span>)</span><span class="hljs-comment">;</span>

</code></pre>
<h1>The little baby staller helper</h1>
<p>Give it a name and make it a bit more re-usable.</p>
<pre><code><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stall</span>(<span class="hljs-params">stallTime = 3000</span>) </span>{
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(resolve =&gt; setTimeout(resolve, stallTime));
}
</code></pre>
<p>The above helper can be used by just awaiting it (see below)</p>
<pre><code>
<span class="hljs-keyword">var</span> doSomething = <span class="hljs-keyword">async</span> () =&gt; {

  <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">await</span> someRemoteOperation();

  <span class="hljs-keyword">await</span> stall(); <span class="hljs-comment">// stalls for the default 3 seconds</span>
  <span class="hljs-keyword">await</span> stall(<span class="hljs-number">500</span>); <span class="hljs-comment">// stalls for 1/2 a second</span>

  <span class="hljs-keyword">await</span> doSomethingElse(data);

}

</code></pre>
<p>Now we have an <code>async</code> function that runs slower - isn't that what you always wanted?</p>
<p>Happy Stalling!</p>
</div>

      <a href="/2016/07/easily-simulate-slow-async-calls-using-javascript-async-await/#disqus_thread" data-disqus-identifier="/2016/07/easily-simulate-slow-async-calls-using-javascript-async-await/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/06/one-programmers-letter-to-his-wife/">One Programmers Letter to his Wife</a></h1>
    <p class="meta">
          <time datetime="2016-06-29T01:46:02.830Z" pubdate data-updated="true">Jun 28th 2016</time>


        <a href="/2016/06/one-programmers-letter-to-his-wife/#disqus_thread" data-disqus-identifier="/2016/06/one-programmers-letter-to-his-wife/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>One of my core natures is as a builder and creator. I'm strongly introverted so much of my time is spent in my own head. My best and sometimes worst times are regularly spent by myself. I know you already know many things about introverts, but as a refresher I'd like you to read this.</p>
<blockquote>
<p><a href="http://www.theatlantic.com/magazine/archive/2003/03/caring-for-your-introvert/302696/">Caring for your introvert</a></p>
</blockquote>
<p>As a creator, one of the happiest moments we can experience is getting into a state of &quot;flow&quot;.</p>
<blockquote>
<p>In positive psychology, flow, also known as the zone, is the mental state of operation in which a person performing an activity is fully immersed in a feeling of energized focus, full involvement, and enjoyment in the process of the activity.
<a href="">https://en.wikipedia.org/wiki/Flow_(psychology)</a></p>
</blockquote>
<p>I've heard this flow state described as a process where the mind is so focus on the task at hand, so engulfed in the spirit of the process that all other external processing of our environment and even our own bodily needs can be ignored. The brain puts so much energy and focus into this, that things like the need to eat, sleep, or sometimes even ignoring the restroom (for as long as possible - waiting until my bladder is SCREAMING at me).</p>
<p>I'm quite happy when I'm making progress on my creation(s) as they can often invoke this flow state. While the opposite of the &quot;enjoyment&quot; can certainly happen while working on projects as they can frustrate the heck out of me sometimes and if it ever bleeds into our relationship I'm sorry for that.</p>
<p>I wish I could convey the highs I can experience while in &quot;flow&quot; as strongly as you've likely see my frustrations about the lows. Sadly, without the lows, struggle, up hill battles, cussing at the computer I could possibly never really experience the feelings of success or overcoming that struggle and enjoy them as much as I do.</p>
<p>Between work, family time, children, shopping, housework, sleep and whatever else we fill our days with, it often times feels like I get to apply very little time to this thing that I am truly driven (maybe slightly addicted to) and excited about.</p>
<p>I know you try to give me time to work on these things. There are times you think you've given a Saturday morning or an evening for me to work on my thing. However, sadly for it to truly be a successful session, I need time and space with room to concentrate. An hour before bedtime makes me feel like I shouldn't even try, because it could take at least 30-40 min to get back into the project leaving so little time to be productive that it's not even worth starting. These are times when I decide to blow any amount of time I've been given and just waste it watching a show on Netflix. Not because I don't want to work on my thing, but because I know the amount of effort it will take to get into the flow state will take far too long to make it worth it. If I were to get into flow, I'm then going to want to stay there and likely push past my bed time (which is getting harder and harder to recover from).</p>
<p>I don't want this to sound like this creation/building thing is more important than my family. In fact it's not. If you look at my actions and track record, the amount of time I have pushed aside so I could help you with your endeavors by watching kids, taking on extra shopping trips, house duties as well as the financial obligation (and strain), and still finding time to spend with you in the evenings at the expense of this thing I want to do should prove that my commitment to the family (and you) is still a priority.</p>
<p>I don't know how to close this out an wrap it up, other than to say I love you. I love my children. I also love what I build. I would like to work with you to find a way to balance these items a little better.</p>
</div>

      <a href="/2016/06/one-programmers-letter-to-his-wife/#disqus_thread" data-disqus-identifier="/2016/06/one-programmers-letter-to-his-wife/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/06/reusable-react-component-with-overridable-inline-css-styles/">Reusable React Component with Overridable Inline CSS Styles</a></h1>
    <p class="meta">
          <time datetime="2016-06-21T21:31:22.600Z" pubdate data-updated="true">Jun 21st 2016</time>


        <a href="/2016/06/reusable-react-component-with-overridable-inline-css-styles/#disqus_thread" data-disqus-identifier="/2016/06/reusable-react-component-with-overridable-inline-css-styles/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>React's Component model is great at allowing the component creator to define the interface that consumers of the component interact with. (What is exposed vs what is abstracted away).</p>
<p>If you're building a component and using any in-line styles and you're not careful you can lock the consumer of your component out of potential customizations they may require for their specific use-case (that you can't think of or foresee). Trying to build components to be reusable and a little more <a href="https://en.wikipedia.org/wiki/Open/closed_principle">OCP</a> can be challenging especially with how difficult it can be to get css layouts the way you (or the consumer of your component) may want...</p>
<p>As an example, let's create simple <code>img</code> component to illustrate the point.</p>
<p>Let's say we have the following image component.</p>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'reac</span>t';

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Image</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> {</span>

  render() {
    <span class="hljs-keyword">return</span> (
      &lt;div&gt;
        &lt;img src={<span class="hljs-keyword">this</span>.props.src} /&gt;
      &lt;/div&gt;
    );
  }

}
</code></pre>
<p>The above component is very simple and very specific.</p>
<p>Now let's say we allow our consumers to customize the height or width of the image. You may think, ok, simple we'll just allow the consumer to specify <code>height</code> and <code>width</code> as props to the component.</p>
<p>So the consumer could just go <code>&lt;Image height=&quot;20&quot; width=&quot;20&quot; src=&quot;someimage.png&quot; /&gt;</code>.</p>
<p>And you end up with something that could look like this.</p>
<pre><code><span class="hljs-keyword">import</span> <span class="hljs-type">React</span> from <span class="hljs-symbol">'reac</span>t';

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Image</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> {</span>

  render() {
    let imageStyle = {
      height: <span class="hljs-keyword">this</span>.props.height,
      width: <span class="hljs-keyword">this</span>.props.width
    };
    <span class="hljs-keyword">return</span> (
      &lt;div&gt;
        &lt;img src={<span class="hljs-keyword">this</span>.props.src} style={imageStyle} /&gt;
      &lt;/div&gt;
    );
  }
}
</code></pre>
<p>Now this works for a while, the consumers of your component are happy they can control the <code>height</code> and <code>width</code> and everyone's humming along merrily.</p>
<p>Then someone comes to you and says they are having some layout issues and need to control something like <code>float</code>, or <code>margin</code>, or <code>padding</code>... This idea of extending the component with more props could become cumbersome if we have to do this for each and every potential layout option available.</p>
<p>How could we extend this generic pattern into something that allows the component to define a general set of happy defaults, while still giving the consumer complete control over layout?</p>
<h1>One Possible Solution</h1>
<p>We can use something like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign()</a> to easily accomplish this.</p>
<p>We can allow the consumers to pass in their own <code>style={...}</code> property and provide a set of sensible defaults for the component, but allow the consumer of our component to completely override a style if necessaryl</p>
<p>We can update our:</p>
<pre><code>    let imageStyle = {
      <span class="hljs-variable">height</span>: <span class="hljs-keyword">this</span>.props.<span class="hljs-variable">height</span>,
      <span class="hljs-variable">width</span>: <span class="hljs-keyword">this</span>.props.<span class="hljs-variable">width</span>
    };
</code></pre>
<p>to the following pattern:</p>
<pre><code>    <span class="hljs-keyword">let</span> imageStyle = Object.<span class="hljs-keyword">assign</span>(
      {},                               <span class="hljs-comment">// target (starting with)</span>
      { ...sensible defaults... },  <span class="hljs-comment">// some pre-defined default React inline-style for the component</span>
      <span class="hljs-keyword">this</span>.props.style              <span class="hljs-comment">// allow consumers to override properties</span>
    );
</code></pre>
<p>Now if the consumer calls the component with <code>&lt;Image style={{height: &quot;21px&quot;, width: &quot;21px&quot;}} src=&quot;someImage.png&quot; /&gt;</code> the component's consumers' values will override any defaults provided. And they can extend the style with anything else they may need.</p>
<p>Happy Componentization!</p>
</div>

      <a href="/2016/06/reusable-react-component-with-overridable-inline-css-styles/#disqus_thread" data-disqus-identifier="/2016/06/reusable-react-component-with-overridable-inline-css-styles/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/05/strange-error-on-docker-compose-up/">Strange error on docker-compose up: oci runtime error: exec format error</a></h1>
    <p class="meta">
          <time datetime="2016-05-27T20:18:56.884Z" pubdate data-updated="true">May 27th 2016</time>


        <a href="/2016/05/strange-error-on-docker-compose-up/#disqus_thread" data-disqus-identifier="/2016/05/strange-error-on-docker-compose-up/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I ran into a non-intuitive error while mucking around with <a href="https://docs.docker.com/compose/">docker-compose</a> recently on <a href="https://staxmanade.com/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">an example</a>.</p>
<h1>docker-compose up</h1>
<pre><code>Building some_server
Step 1 : FROM alpine
 -<span class="ruby">--&gt; <span class="hljs-number">13</span>e1761bf172
</span>Step 2 : ENV DEMO_VAR WAT
 -<span class="ruby">--&gt; <span class="hljs-constant">Using</span> cache
</span> -<span class="ruby">--&gt; <span class="hljs-number">378</span>dbaa4a048
</span>Step 3 : COPY docker-entrypoint.sh /
 -<span class="ruby">--&gt; e5962cef9382
</span>Removing intermediate container 43fa24c31444
Step 4 : ENTRYPOINT /docker-entrypoint.sh
 -<span class="ruby">--&gt; <span class="hljs-constant">Running</span> <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>a2e19bf7a45
</span> -<span class="ruby">--&gt; <span class="hljs-number">331</span>d2648d969
</span>Removing intermediate container 5a2e19bf7a45
Successfully built 331d2648d969
Recreating exampleworkingdockercomposeenvironmentvars_some_server_1
</code></pre>
<h1>The Error</h1>
<pre><code>ERROR: for some_server  rpc error: code = 2 desc = "oci runtime error: exec format error"
Traceback (most recent <span class="hljs-operator"><span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):
  <span class="hljs-keyword">File</span> <span class="hljs-string">"&lt;string&gt;"</span>, line <span class="hljs-number">3</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
  <span class="hljs-keyword">File</span> <span class="hljs-string">"compose/cli/main.py"</span>, line <span class="hljs-number">63</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">main</span>
AttributeError: <span class="hljs-string">'ProjectError'</span> <span class="hljs-keyword">object</span> has <span class="hljs-keyword">no</span> <span class="hljs-keyword">attribute</span> <span class="hljs-string">'msg'</span>
docker-compose returned -<span class="hljs-number">1</span>
</span></code></pre>
<h1>The Actual Problem and Solution:</h1>
<p>I had a <code>Dockerfile</code> that used an entrypoint that looked like <code>ENTRYPOINT [&quot;/docker-entrypoint.sh&quot;]</code>.</p>
<p>The real problem was the <code>docker-entrypoint.sh</code> script was missing a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">#shebang</a>.</p>
<p>So changing this</p>
<pre><code><span class="hljs-built_in">echo</span> <span class="hljs-string">"ENV Var Passed in: <span class="hljs-variable">$DEMO_VAR</span>"</span>
</code></pre>
<p>to this</p>
<pre><code><span class="hljs-shebang">#!/bin/sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ENV Var Passed in: <span class="hljs-variable">$DEMO_VAR</span>"</span>
</code></pre>
<p>solved my issue!</p>
<p>Also note it'll depend on the base image <code>FROM &lt;some linux distro&gt;</code> that may change what you're required #shebang should be.</p>
<p>Whew!</p>
</div>

      <a href="/2016/05/strange-error-on-docker-compose-up/#disqus_thread" data-disqus-identifier="/2016/05/strange-error-on-docker-compose-up/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">How to Get Environment Variables Passed Through docker-compose to the Containers</a></h1>
    <p class="meta">
          <time datetime="2016-05-26T04:36:41.974Z" pubdate data-updated="true">May 25th 2016</time>


        <a href="/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/#disqus_thread" data-disqus-identifier="/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>I've been playing with a <a href="https://github.com/staxmanade/sample-pouch-couch-databaseperuser">little toy</a> that uses <a href="https://docs.docker.com/compose">docker-compose</a> to bring together a web app, couchdb, and redis container into an easy-ier-ish cohesive unit.</p>
<p>While working on it (and to make it a bit more generic), my next step was to find a way to pass the database admin user/pass (and other configuraiton options) into the containers as <strong>environment variables</strong> which took me way longer to figure out than it should have...</p>
<p>Hopefully this posts helps it click for you a little faster than it (didn't) for me :)</p>
<p>If you land here, you've likely already poured over the different parts of documentation for docker, docker-compose and environment variables.</p>
<p>Things like:</p>
<ul>
<li><a href="https://docs.docker.com/compose/compose-file/#variable-substitution">https://docs.docker.com/compose/compose-file/#variable-substitution</a></li>
<li><a href="https://docs.docker.com/compose/compose-file/#env-file">https://docs.docker.com/compose/compose-file/#env-file</a></li>
<li><a href="http://stackoverflow.com/questions/29377853/how-to-use-environment-variables-in-docker-compose">http://stackoverflow.com/questions/29377853/how-to-use-environment-variables-in-docker-compose</a></li>
<li>Google: <a href="http://lmgtfy.com/?q=docker-compose+environment+variables">docker-compose environment variables</a></li>
</ul>
<p>In case things drift in the product or docs, this post was written using <code>docker-compose version 1.7.1, build 0a9ab35</code> so keep that in mind...</p>
<p>I think the difficult thing for me was piecing the various ways you can get environment variables defined and the necessary mapping required within the <code>docker-compose</code> file.</p>
<h1>Environment Variable Setup Stages.</h1>
<p>For me it didn't click until I was able to think about the stages that needed to exist for an environment variable to go from the development computer -&gt; to the -&gt; docker container.</p>
<p>For now I'm thinking of using the following model...</p>
<pre><code>
 ------------------------       --------------------       ------------------
|<span class="hljs-string">   Env Source           </span>|<span class="hljs-string">     </span>|<span class="hljs-string"> docker-compose.yml </span>|<span class="hljs-string">     </span>|<span class="hljs-string"> Docker Container </span>|
|<span class="hljs-string">                        </span>|<span class="hljs-string">     </span>|<span class="hljs-string">                    </span>|<span class="hljs-string">     </span>|<span class="hljs-string">                  </span>|
|<span class="hljs-string">   A) .env file         </span>|<span class="hljs-string"> --&gt; </span>|<span class="hljs-string"> map env vars using </span>|<span class="hljs-string"> --&gt; </span>|<span class="hljs-string"> echo $DEMO_VAR   </span>|
|<span class="hljs-string">   B) run-time terminal </span>|<span class="hljs-string">     </span>|<span class="hljs-string"> interpolation      </span>|<span class="hljs-string">     </span>|<span class="hljs-string">                  </span>|
|<span class="hljs-string">       env var          </span>|<span class="hljs-string">     </span>|<span class="hljs-string"> in this file.      </span>|<span class="hljs-string">     </span>|<span class="hljs-string">                  </span>|
 ------------------------      ---------------------       ------------------
</code></pre>
<h1>A working example.</h1>
<p>If you want to see all of this in one place <a href="https://github.com/staxmanade/example-working-docker-compose-environment-vars">check out this github example</a> which is outline below.</p>
<p>The example above is layed out like so...</p>
<pre><code>.
|<span class="hljs-string">____.env
</span>|<span class="hljs-string">____docker-compose.yml
</span>|<span class="hljs-string">____env-file-test
</span>|<span class="hljs-string"> </span>|<span class="hljs-string">____docker-entrypoint.sh
</span>|<span class="hljs-string"> </span>|____Dockerfile
|<span class="hljs-string">____README.md
</span></code></pre>
<h1>The <code>.env</code> file:</h1>
<p>This is where you can place each of the environment variables you need in here.</p>
<pre><code>DEMO_VAR=Test <span class="hljs-built_in">value</span> <span class="hljs-built_in">from</span> .env <span class="hljs-built_in">file</span>!
</code></pre>
<p>As the <a href="https://docs.docker.com/compose/compose-file/#env-file">docs say</a> you can use <code># as comments</code> and blank lines in the file - all other lines must be in the format of <code>ENV_VAR=ENV_VALUE</code>.</p>
<p><img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> environment variables in your terminal's context will take president over the values in the <code>.env</code> file. <img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"></p>
<h1>The <code>docker-compose.yml</code>:</h1>
<pre><code><span class="hljs-keyword">version</span>: <span class="hljs-string">"2"</span>
services:
  some_server:
    build: ./env-<span class="hljs-keyword">file</span>-<span class="hljs-keyword">test</span>
    environment:
     - DEMO_VAR=<span class="hljs-label">${DEMO_VAR}</span>
</code></pre>
<p>The above file is the part where I got tripped up, and once I added the <code>environment:</code> section it all clicked.</p>
<p>You likely don't want every one of your development or production server's environment variables to show up inside your container. This file acts a bit like the <code>docker run -e ENV_VAR=FOO</code> option and allows you to select specific environment variables that are to be passed into the container.</p>
<p>I like the declarative approach of this file as it makes environment variable dependencies explicit.</p>
<h1>The <code>env-file-test/Dockerfile</code>:</h1>
<pre><code><span class="hljs-built_in">FROM</span> alpine

<span class="hljs-built_in">ENV</span> DEMO_VAR WAT

<span class="hljs-built_in">COPY</span> <span class="bash">docker-entrypoint.sh /
</span><span class="hljs-built_in">ENTRYPOINT</span> <span class="bash">[<span class="hljs-string">"/docker-entrypoint.sh"</span>]
</span></code></pre>
<p>Pretty standard <code>Dockerfile</code>, but one thing I learned is you can setup default environment variables using the <a href="https://docs.docker.com/engine/reference/builder/#env">docker <code>ENV</code></a> directive. But these will be overriden by the <code>.env</code> file or variables in your terminal's environment.</p>
<h1>The <code>env-file-test/docker-entrypoint.sh</code></h1>
<pre><code><span class="hljs-shebang">#!/bin/sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ENV Var Passed in: <span class="hljs-variable">$DEMO_VAR</span>"</span>
</code></pre>
<p>This was just a sample script to print out the environment variable.</p>
<h1>Some other things I learned</h1>
<p><img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> The docs say you can specify your own <code>env-file</code> or even multiple files, however I could not get that working. It always wanted to choose the <code>.env</code> file.</p>
<p><img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"> Also note: that if you have an environment variable specified in your terminal that also exists in your <code>.env</code> file the terminal's environment takes precedence over the <code>.env</code> file. <img class="emoji" title="warning" alt="warning" src="https://assets-cdn.github.com/images/icons/emoji/unicode/26a0.png" height="20" width="20" align="absmiddle"></p>
<p>Happy Environment Setup!</p>
</div>

      <a href="/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/#disqus_thread" data-disqus-identifier="/2016/05/how-to-get-environment-variables-passed-through-docker-compose-to-the-containers/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/05/configuring-git-to-use-different-name-and-email-depending-on-folder-context/">Configuring Git to Use Different Name and Email Depending on Folder Context</a></h1>
    <p class="meta">
          <time datetime="2016-05-25T22:16:39.455Z" pubdate data-updated="true">May 25th 2016</time>


        <a href="/2016/05/configuring-git-to-use-different-name-and-email-depending-on-folder-context/#disqus_thread" data-disqus-identifier="/2016/05/configuring-git-to-use-different-name-and-email-depending-on-folder-context/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p>Thought I'd share how I'm configuring <code>user.name</code> and <code>user.email</code> for git on my work computer. This is really just a post so when I forget how I did in the future I can google my own blog and be reminded...</p>
<p>I have always struggled with accidentally committing to an OSS project my work name/email or visa-versa, committing to a work git repo with my personal name/email.</p>
<p>For most, <code>user.name</code> shouldn't change, unless your company ties your <code>user.name</code> to something specific to the company like a username. (Contrast: <code>user.name = Jason Jarrett</code> and <code>user.name = jjarrett</code>).</p>
<p>When I clone projects I always clone them into a folder structure that looks like</p>
<pre><code>|____~/code
| |____personal/  &lt;--- <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> where I would put some OSS projects <span class="hljs-literal">that</span> I may be working <span class="hljs-literal">on</span> <span class="hljs-keyword">or</span> contributing <span class="hljs-keyword">to</span>.
| |____work/      &lt;--- obviously work code goes <span class="hljs-keyword">in</span> here
</code></pre>
<p>Thanks to <a href="http://collectiveidea.com/blog/archives/2016/04/04/multiple-personalities-in-git/">this post</a> where I learned about <a href="http://direnv.net/">direnv</a> and followed the last option I basically used these steps...</p>
<h1>Setup</h1>
<ol>
<li>
<p>Install <code>direnv</code> - <code>brew install direnv</code> (What about Windows? see <a href="https://github.com/direnv/direnv/issues/124">this github issue</a> and help make it work)</p>
</li>
<li>
<p>Create <code>.envrc</code> file <strong>for each profile</strong> needing to be setup with the following content</p>
<pre><code>export GIT_AUTHOR_EMAIL=<span class="hljs-tag">&lt;<span class="hljs-title">your</span> <span class="hljs-attribute">email</span>&gt;</span>
export GIT_AUTHOR_NAME=<span class="hljs-tag">&lt;<span class="hljs-title">your</span> <span class="hljs-attribute">name</span>&gt;</span>
export GIT_COMMITTER_EMAIL=<span class="hljs-tag">&lt;<span class="hljs-title">your</span> <span class="hljs-attribute">email</span>&gt;</span>
export GIT_COMMITTER_NAME=<span class="hljs-tag">&lt;<span class="hljs-title">your</span> <span class="hljs-attribute">name</span>&gt;</span>
</code></pre>
</li>
<li>
<p>After installing and setting the <code>.envrc</code> files <a href="http://direnv.net/"><code>direnv</code></a> will prompt to use the env file which we accept by running <code>direnv allow</code>.</p>
</li>
</ol>
<p>Now I should have the following structure</p>
<pre><code>|<span class="hljs-string">____~/code
</span>|<span class="hljs-string"> </span>|<span class="hljs-string">____personal/
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">____.envrc   &lt;-- env settings with personal git user/email
</span>|<span class="hljs-string"> </span>|<span class="hljs-string">____work/
</span>|<span class="hljs-string">    </span>|<span class="hljs-string">____.envrc   &lt;-- env settings with work git user/email

</span></code></pre>
<h1>What did this do?</h1>
<p>Each time we <code>cd</code> into either a <code>personal/</code> or <code>work/</code> folder <code>direnv</code> will setup our shell with environment variables contained in that folder's <code>.envrc</code> file. This will then allow Git which respects these env vars and now we don't have to think about committing the wrong name/email to the wrong Git repositories.</p>
<p>Happy Gitting!</p>
</div>

      <a href="/2016/05/configuring-git-to-use-different-name-and-email-depending-on-folder-context/#disqus_thread" data-disqus-identifier="/2016/05/configuring-git-to-use-different-name-and-email-depending-on-folder-context/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/05/how-not-to-start-asynchronous-communication/">How NOT to Start Asynchronous Communication</a></h1>
    <p class="meta">
          <time datetime="2016-05-20T21:50:33.499Z" pubdate data-updated="true">May 20th 2016</time>


        <a href="/2016/05/how-not-to-start-asynchronous-communication/#disqus_thread" data-disqus-identifier="/2016/05/how-not-to-start-asynchronous-communication/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><div style="height: 100px">&nbsp;</div>
<h2>Hey!</h2>
<div style="height: 2000px">&nbsp;</div>
<h1>Don't you hate it when...</h1>
<p>...someone is using a beautifully designed asynchronous tool to communicate with you but instead they try to pretend it is synchronous?</p>
<p>Please!!! If you ever have to communicate with someone through an asynchronous-able tool like a text message, instant messaging, or email don't just say <code>Hey!</code> and wait for a response.</p>
<p>Try saying <code>Hey! I wonder if you could...</code> or some alternative where the single message can contain both a polite introduction <code>Hey</code> along with some actionable context about why the polite introduction has taken place. If you can't begin to privde the initial context and are waiting for the other person to respond with <code>Hey</code>, you've both wasted their time and yours.</p>
<p>Often times a single chat message can distract someone who is concentrating hard on a subject. If a hollow <code>Hey!</code> is provided, you've likely pulled whoever you wanted to talk to out of that concetration as well as not provide them enough context to be abel to respond or help you. Instead they're possibly sitting there waiting for you to say something next, or maybe you're waiting for them to say Hey back (which you may never get)...</p>
<p>Asynchronous communication can be an amazing productivity tool if used efficiently.</p>
<p>Happy Chatting!</p>
</div>

      <a href="/2016/05/how-not-to-start-asynchronous-communication/#disqus_thread" data-disqus-identifier="/2016/05/how-not-to-start-asynchronous-communication/">(Comments)</a>
    </article>
    <article>
        <header>
    <h1 class="entry-title"><a href="https://staxmanade.com/2016/04/easily-convert-css-to-react-inline-styles/">Easily Convert CSS to React Inline Styles</a></h1>
    <p class="meta">
          <time datetime="2016-04-21T04:52:14.458Z" pubdate data-updated="true">Apr 20th 2016</time>


        <a href="/2016/04/easily-convert-css-to-react-inline-styles/#disqus_thread" data-disqus-identifier="/2016/04/easily-convert-css-to-react-inline-styles/">(Comments)</a>
    </p>
</header>
<div class="entry-content"><p><a target="blank" href="https://staxmanade.com/CssToReact/">
<img align="right" src="https://staxmanade.com/CssToReact/images/CssToReact-logo.svg">
</a></p>
<h3>TL;DR</h3>
<p>Click the logo to jump the tool...</p>
<h2>The More Info Stuff</h2>
<p>So you're working on a React app. It's up and running in your favorite browser but you notice an issue with some layout. You think, ok, this should be easy to fix. You open up the developer tools, hack on some CSS within the browser till you get it looking just the way you want it to. Maybe it's several CSS properties you added or tweaked so you copy each of them into the clipboard so you can transfer them back to your application.</p>
<p>Then you realize, these styles aren't coming from a CSS style sheet, they're in-line styles right in your React component.</p>
<p>Now you're like, FINE, I'll manually translate this to React-style-inline-CSS. This is no biggie if you do it once in a while. Except that time when you missed removing a dash or mis-cased a letter or maybe you forgot a JSON comma, or left a CSS semicolon. Never happened to you? Oh, you are so amazing if only I was as super cool as you. For myself and probably another 1 or 2 of you out there these problems do come up, but don't have to.</p>
<p>I hacked together a <a href="https://staxmanade.com/CssToReact/">little tool</a> that automates this translation. Allows you to paste your <code>CSS</code> into a <code>textarea</code>, it translates to React inline style JSON CSS and you can copy it out while avoiding translation bugs.</p>
<p>You can see the project here: <a href="https://staxmanade.com/CssToReact/">CssToReact</a>
If you have a suggestion or want to pull-request it your self you can check it out here: <a href="https://github.com/staxmanade/CssToReact">Source to Project</a></p>
<blockquote>
<p>Aside: This should really be a plugin to my text editor where we can right click and say &quot;Paste as React Style&quot; instead, but for now it's a single simple little web page that will automate the translation for you. (I haven't looked for the plugin - if it exists or ever is created let me know in the comments...)</p>
</blockquote>
<p>Happy CSS Conversions!</p>
</div>

      <a href="/2016/04/easily-convert-css-to-react-inline-styles/#disqus_thread" data-disqus-identifier="/2016/04/easily-convert-css-to-react-inline-styles/">(Comments)</a>
    </article>
  <div class="pagination">
      <a class="prev" href="/blog/pages/3/">&larr; Older</a>
    <a href="/blog/archives">Blog Archives</a>
      <a class="next" href="/blog/pages/1/">Newer &rarr;</a>
  </div>
</div>


    </div>
</div>
<footer role="contentinfo"><p>
  This work is licensed under a
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    Creative Commons Attribution 4.0 International License
  </a>.

</p>
<p>
  Copyright &copy; 2008-2018 - <a href="/about">Jason Jarrett</a> - <span class="credit">Powered by <a href="http://togglejs.github.io">Toggle</a></span>
</p>


<style>
  .jj-signup-form {
    text-align: right;
    position: fixed;
    bottom: 0;
    right: 0;
    width: 300px;
    display: none;
  }
</style>

<style>
    .jj-signup-form {
        border-width: thin;
        border-color: black;
        border-style: solid;
        background-color: white;
    }
</style>
<div class="jj-signup-form">
    <button class="jj-signup-form-close">Close</button>
    <div>
        <!-- Begin MailChimp Signup Form -->
        <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
        <style type="text/css">
            #mc_embed_signup {
                background: #fff;
                clear: left;
                font: 14px Helvetica, Arial, sans-serif;
            }
            /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
        </style>
        <div id="mc_embed_signup">
            <form action="//staxmanade.us8.list-manage.com/subscribe/post?u=9a6f3f89fc58e1bbbddf5c3f8&amp;id=9e5406be65" method="post"
                id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                <div id="mc_embed_signup_scroll">
                    <h2>Don't miss a post...</h2>
                    <div class="mc-field-group">
                        <label for="mce-FNAME">First Name </label>
                        <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
                    </div>
                    <div class="mc-field-group">
                        <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
                        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                    </div>
                    <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>
                    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9a6f3f89fc58e1bbbddf5c3f8_9e5406be65" tabindex="-1" value=""></div>
                    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </div>
            </form>
        </div>
        <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script>
        <script type='text/javascript'>
            (function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[1]='FNAME';ftypes[1]='text';fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);
        </script>
        <!--End mc_embed_signup-->
    </div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.1/js.cookie.min.js"></script>
<script>
  (function(){
    try {
      if (Cookies.get('IKnowItIsACrappyPopupButMeh') !== "clicked") {
        document.querySelector('.jj-signup-form-close').addEventListener('click', function(){
            document.querySelector('.jj-signup-form').style.display = "none";
            Cookies.set("IKnowItIsACrappyPopupButMeh", "clicked", { expires: 180 });
        });

        setTimeout(function(){
          if(window.jjdisableSignupPopup) {
            return;
          }
          document.querySelector('.jj-signup-form').style.display = "initial";
        }, 1000);
      }

    } catch(e) {
        console.log(e);
    }
  })();

</script>
</footer>
  



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



</body>
</html>
